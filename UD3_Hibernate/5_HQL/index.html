
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../4_Relationships/">
      
      
        <link rel="next" href="../../UD4_BDOO/1_Introduction/">
      
      
      <link rel="icon" href="../../assets/jaume.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>5. Consultes - Accés a Dades</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-hibernate-query-language" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="../.." title="Accés a Dades" class="md-header__button md-logo" aria-label="Accés a Dades" data-md-component="logo">
      
  <img src="../../assets/jaume.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Accés a Dades
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5. Consultes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="brown" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Selecciona la llengua">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../en/UD3_Hibernate/5_HQL/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="ca" class="md-select__link">
              Valencià
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Accés a Dades" class="md-nav__button md-logo" aria-label="Accés a Dades" data-md-component="logo">
      
  <img src="../../assets/jaume.png" alt="logo">

    </a>
    Accés a Dades
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accés a Dades - Informació del mòdul
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 1. Fitxers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Unitat 1. Fitxers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/1_File_System/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Sistema de Fitxers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/2_Reading_and_writing_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Llegint i Escrivint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/3_XML_Files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Treball amb Arxius XML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/4_JSON_Files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Treball amb Arxius JSON
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/5_CSV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Arxius separats per comes. CSV
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/6_Properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Arxius de propietats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/7_Llibreries_Conversores/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Llibreries conversores
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 2. Connectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Unitat 2. Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/1_Object_relational_impedance_mismatch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Desfase objecte-relacional
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/2_Connectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Connectors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/3_Connecting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Connectant-se a la base de dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/4_Resultset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Resultats de les consultes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/5_Metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Metadades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/6_CRUD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Operacions CRUD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/7_Row_to_Object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. De les files als objectes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 3. Hibernate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Unitat 3. Hibernate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_Mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Mapeig d'objectes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_Hibernate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Introduccio a Hibernate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_Entities_Beans/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Entitats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_Relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Relacions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    5. Consultes
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    5. Consultes
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-hibernate-query-language" class="md-nav__link">
    <span class="md-ellipsis">
      1. Hibernate Query Language
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-recuperant-objectes" class="md-nav__link">
    <span class="md-ellipsis">
      2. Recuperant objectes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-consultes" class="md-nav__link">
    <span class="md-ellipsis">
      3. Consultes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Consultes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-obtenint-objectes-simples" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. Obtenint objectes simples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-obtenint-objectes-compostos" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. Obtenint objectes compostos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-parametres-i-consultes-nominals-amb-nom" class="md-nav__link">
    <span class="md-ellipsis">
      4. Paràmetres i Consultes Nominals (amb nom)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Paràmetres i Consultes Nominals (amb nom)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-parametres-posicionals" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Paràmetres posicionals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-parametres-nominals" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Paràmetres nominals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-consultes-amb-nom" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Consultes amb nom
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-crud" class="md-nav__link">
    <span class="md-ellipsis">
      5. CRUD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. CRUD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-crear-create-insert" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Crear (Create - Insert)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-actualitzacio-update" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Actualització (Update)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-eliminacio-delete" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Eliminació (Delete)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-apendix-estat-dels-objectes" class="md-nav__link">
    <span class="md-ellipsis">
      6. Apèndix, Estat dels objectes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 4. Bases de Dades OO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Unitat 4. Bases de Dades OO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/1_Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduccio a les bases de dades OO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/2_ORDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Bases de dades Objecte-Relacionals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/3_OODB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Bases de dades Orientades a Objectes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 5. Spring
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Unitat 5. Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD5_Spring/1_Data_Access_Services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Serveis d'Acces a Dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD5_Spring/2_Spring_SpringBoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Introducció a Spring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD5_Spring/3_API_Rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Creació de APIs REST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD5_Spring/4_Spring_Security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Seguretat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD5_Spring/5_Spring_Hateoas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Spring Haetoas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD5_Spring/6_Postman_Swagger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Test. Postman i Swagger
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 6. MongoDB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Unitat 6. MongoDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/1_NoSQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Bases de dades NoSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/2_MongoDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/3_ShellOperations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Treballant amb MongoDB: Operacions bàsiques de shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/4_Queries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Consultese en Mongo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/5_Mongo_Java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MongoDB i Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/6_Spring_MongoDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Spring Data MongoDB i API REST
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pràctiques
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Pràctiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Practiques/APAC1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pràctica 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llicència
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-hibernate-query-language" class="md-nav__link">
    <span class="md-ellipsis">
      1. Hibernate Query Language
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-recuperant-objectes" class="md-nav__link">
    <span class="md-ellipsis">
      2. Recuperant objectes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-consultes" class="md-nav__link">
    <span class="md-ellipsis">
      3. Consultes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Consultes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-obtenint-objectes-simples" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. Obtenint objectes simples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-obtenint-objectes-compostos" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. Obtenint objectes compostos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-parametres-i-consultes-nominals-amb-nom" class="md-nav__link">
    <span class="md-ellipsis">
      4. Paràmetres i Consultes Nominals (amb nom)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Paràmetres i Consultes Nominals (amb nom)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-parametres-posicionals" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Paràmetres posicionals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-parametres-nominals" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Paràmetres nominals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-consultes-amb-nom" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Consultes amb nom
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-crud" class="md-nav__link">
    <span class="md-ellipsis">
      5. CRUD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. CRUD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-crear-create-insert" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Crear (Create - Insert)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-actualitzacio-update" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Actualització (Update)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-eliminacio-delete" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Eliminació (Delete)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-apendix-estat-dels-objectes" class="md-nav__link">
    <span class="md-ellipsis">
      6. Apèndix, Estat dels objectes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>5. Consultes</h1>

<h2 id="1-hibernate-query-language">1. Hibernate Query Language</h2>
<p>La documentació completa es pot trobar aquí:</p>
<ul>
<li>In <a href="https://docs.jboss.org/hibernate/core/3.6/reference/es-ES/html/queryhql.html">spanish</a></li>
<li>In <a href="https://docs.jboss.org/hibernate/core/4.3/manual/en-US/html/ch16.html">english</a></li>
</ul>
<p>El llenguatge <strong>HQL</strong> (Hibernate Query Language) va néixer amb l'objectiu de preservar el model relacional, ja que és un superset de SQL (extensió de SQL que inclou SQL). La primera consideració és que, per defecte, la seva funcionalitat és recuperar objectes de la base de dades, no taules com fèiem en el llenguatge SQL a través de <code>ResultSet</code>. Les consultes amb HQL es faran des d'una interfície <strong>Query</strong>, que serà el lloc on especificarem què volem obtenir. Opcionalment, podem afegir a la consulta els paràmetres necessaris per a la seva execució, per evitar consultes amb codi dur.</p>
<p>En primer lloc, la consulta serà preparada. En crear-la, hem de tenir en compte dues opcions, amb quatre combinacions possibles:</p>
<ul>
<li>Retornarà un resultat o més d'un i,</li>
<li>Retornarà el resultat encapsulat en objectes o de manera composta.</li>
</ul>
<p>Depenent de la resposta obtinguda, en el segon pas triarem una de les quatre opcions vistes a continuació.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="mi">1</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;HQL statement&quot;</span><span class="p">);</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="mf">2.1</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultsObjects</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="mf">2.2</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="w"> </span><span class="o">[]&gt;</span><span class="n">mixedresults</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="mf">2.3</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">uniqueResult</span><span class="p">();</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="mf">2.4</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">uniqueResult</span><span class="p">();</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="mf">1.</span><span class="w"> </span><span class="c1">// process information obtained</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>In first option the query returns a collection of objects (several rows, on object in a row).</li>
<li>This option return a collection with a composite of objects and another types: for example a Student a number of topics and number of teachers.</li>
<li>Both last options is when, instead of a collection, the query returns a unique object/composite.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Apunt...</p>
<ul>
<li><code>session.createQuery</code> → permet escriure una consulta HQL, amb o sense paràmetres.</li>
<li>
<p><code>Query.list()</code> → obté tots els objectes (com una Llista) de la base de dades que satisfan la consulta.</p>
</li>
<li>
<p><code>Query.uniqueResult()</code> → obté un únic objecte de la base de dades.</p>
</li>
</ul>
</div>
<p>Abans dels detalls, aquí trobaràs algunes idees generals:</p>
<ul>
<li>Podem eliminar el <code>Select *</code>, per indicar que volem tots els atributs.</li>
<li>Hi ha una sensibilitat mitjana a les majúscules i minúscules: les paraules reservades de HQL no distingeixen entre majúscules i minúscules, però les referències als objectes (els seus noms) sí que ho fan: no importa posar <code>From</code> o <code>fROm</code>, però un <code>Student</code> no és el mateix que un <code>student</code>. Es recomana escriure les sentències en minúscules, per tal de distingir-les de les classes.</li>
<li>Després de <code>from</code>, apareix el nom d'una classe (o classes), no de taules.</li>
<li>Assignar àlies és altament recomanable. Podem utilitzar joins de manera similar a SQL.</li>
<li>Després pot aparèixer el <code>where</code>, amb les seves condicions similars a SQL.</li>
<li>Les constants de text es tanquen entre cometes simples.</li>
<li>Podem consultar col·leccions que apareixen dins dels objectes (per exemple, el conjunt d'estudiants d'un professor).</li>
<li>No hi ha operador <code>limit</code>.</li>
<li><code>order by</code> s'utilitza de manera similar a SQL.</li>
<li><code>group by</code> està permès, i les funcions agregades són: COUNT, AVG, SUM, MIN i MAX.</li>
</ul>
<h2 id="2-recuperant-objectes">2. Recuperant objectes</h2>
<p>A partir d'ara, els exemples es basen en aquest esquema <a href="../DocenciaConsultas.sql">Docencia</a></p>
<p><center><img alt="Docencia for HQL" src="../img/DocenciaHQL.png" width="90%" /></center></p>
<div class="admonition tip">
<p class="admonition-title">Consell</p>
<p>Ara és un bon moment per intentar fer un enfocament d'enginyeria inversa per construir el teu projecte a partir de la base de dades.</p>
</div>
<h2 id="3-consultes">3. Consultes</h2>
<h3 id="31-obtenint-objectes-simples">3.1. Obtenint objectes simples</h3>
<p>Aquestes consultes són les que volem recuperar un objecte o una col·lecció d'aquests de la base de dades (una o més files, en comparació amb ResultSet). Cada resultat és un únic objecte d'una taula de la base de dades. Es caracteritzaran perquè la paraula Select pot no aparèixer o simplement indicar l'àlies de la classe que tenim. Vegem els exemples.</p>
<p>El següent exemple mostra tots els estudiants:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">// complete and polite</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">Query</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a from Alumno a&quot;</span><span class="p">);</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="c1">// OR</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="c1">// in a quick way</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">Query</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;from Alumno&quot;</span><span class="p">);</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="c1">// quickest (without type)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;from Alumno&quot;</span><span class="p">);</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span><span class="w"> </span><span class="n">losAlumnos</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Alumno</span><span class="w"> </span><span class="n">alumno</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">losAlumnos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">alumno</span><span class="p">);</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">        </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Si volem filtrar o cercar qualsevol estudiant, necessitem utilitzar la clàusula <code>where</code>, com en una consulta SQL normal. Les expressions poden ser:</p>
<p><center><img alt="Where" src="../img/Where.png" width="90%" /></center></p>
<p>Quan el filtre <code>where</code> només retorna un objecte, podríem emmagatzemar-lo en una llista i després accedir-hi, però és millor obtenir l'objecte directament, com segueix:</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">Query</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a from Alumno a where a.idAlumno=1&quot;</span><span class="p">);</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">Alumno</span><span class="w"> </span><span class="n">alumno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">uniqueResult</span><span class="p">();</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">alumno</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
tingues en compte que creem la nostra consulta amb l'operador diamant, indicant que retornarà un estudiant. Aleshores, la consulta retorna òbviament l'estudiant. L'alternativa és fer un càsting de l'objecte retornat de <code>uniqueResult</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a from Alumno a where a.idAlumno=1&quot;</span><span class="p">);</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">Alumno</span><span class="w"> </span><span class="n">alumno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Alumno</span><span class="p">)</span><span class="n">q</span><span class="p">.</span><span class="na">uniqueResult</span><span class="p">();</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">alumno</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Atenció</p>
<p>Tingueu cura quan recupereu un objecte únic i la consulta en retorna diversos.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a from Student a where a.age=24&quot;</span><span class="p">);</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">Alumno</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="n">Student</span><span class="p">)</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">uniqueResult</span><span class="p">();</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="c1">// org.hibernate.NonUniqueResultException: query did not return a unique result: 2</span>
</code></pre></div></td></tr></table></div>
</div>
<p>Quan tenim molts resultats, no és convenient recuperar-los tots alhora, sinó accedir-hi de 10 en 10 o similar, igual que les pàgines de cerca de Google o Amazon. Podem aconseguir-ho llançant consultes més petites repetidament, aplicant a la consulta:</p>
<ul>
<li><code>Q.setFirstResult(int start)</code> → indica el primer objecte (fila) a retornar.</li>
<li><code>Q.setMaxResult(int howMany)</code> → indica quantes files retornarà.</li>
</ul>
<p>Amb un algorisme dissenyat adequadament, podem fer un bucle, desplaçant l'inici en cada iteració, incrementant-lo pel nombre de files recuperades en l'iteració anterior. Això implicaria moltes consultes petites en lloc d'una de gran.</p>
<h3 id="32-obtenint-objectes-compostos">3.2. Obtenint objectes compostos</h3>
<p>Si necessitem obtenir més (o menys) dades que un objecte sencer, ho hem de fer a la part <code>select</code> de la clàusula, però quan obtenim les dades no les podem emmagatzemar en un Object. Per aquesta raó, i utilitzant la propietat de polimorfisme de Java, obtenim els resultats en un array genèric d'objectes. Per tant, hem de ser molt curosos amb el tipus de cada cel·la, així com la mida d'aquest array, ja que estarà fortament lligat a la consulta en si. Vegem la següent consulta: <em>Mostra el nom i l'edat dels estudiants</em>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a.nombre,a.edad from Alumno a&quot;</span><span class="p">);</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;Alumno: &quot;</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">objects</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">objects</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Tingues en compte que si només vols imprimir la informació, no cal fer cap treball extra, ja que (gairebé) tots els objectes es poden convertir a String. Si vols utilitzar-los d'una altra manera, tin molt de compte en convertir-los al tipus de dada adequat.</p>
<p><strong>Col·leccions</strong></p>
<p>Anem a comprovar el nom dels estudiants i quants exàmens han fet. Aquesta informació es troba al conjunt d'Exàmens, així que necessitarem manipular aquesta col·lecció:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a.nombre,size(a.examens) from Alumno a&quot;</span><span class="p">);</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">alu</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Alumno: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">alu</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; has done &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">alu</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; exams.&quot;</span><span class="p">);</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Com podeu veure, hem aplicat la funció <code>size()</code> a la col·lecció per veure la seva mida. Per tant, podem aplicar:</p>
<ul>
<li><code>size(collection)</code> → recuperar la mida de la col·lecció.</li>
<li><code>collection is empty</code> | <code>collection is not empty</code> → per determinar si està buida. És equivalent a comparar la mida amb 0.</li>
<li>Els operadors <code>in</code>, <code>all</code> es poden combinar utilitzant l'operador <code>elements(collection)</code>.</li>
</ul>
<p>Com a consulta avançada, podeu utilitzar <code>exists</code> i <code>not exists</code> en les vostres consultes.</p>
<h2 id="4-parametres-i-consultes-nominals-amb-nom">4. Paràmetres i Consultes Nominals (amb nom)</h2>
<p>Normalment, la majoria de consultes necessitaran alguns paràmetres, generalment per al filtratge d'objectes en la clàusula where. Els beneficis de parametritzar les consultes per evitar la injecció de SQL o problemes similars ja es van discutir en la unitat anterior.</p>
<p>La gestió dels paràmetres es realitza de la mateixa manera que amb les sentències preparades (<code>preparedStatements</code>), i es pot fer mitjançant paràmetres posicionals o nominals. Vegem alguns exemples:</p>
<h3 id="41-parametres-posicionals">4.1. Paràmetres posicionals</h3>
<p>Hem d'afegir espais reservats dins de la nostra consulta, però en lloc de <code>?</code> afegim un número després del signe d'interrogació. Després hem de configurar el paràmetre segons el número d'espai reservat que hem establert abans, de la següent manera:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">Query</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Select a from Alumno a where a.edad=?1&quot;</span><span class="p">);</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">q</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">losAlumnos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Alumno</span><span class="w"> </span><span class="n">alumno</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">losAlumnos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">alumno</span><span class="p">);</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Consell</p>
<p>Tingues en compte que el mètode <code>setParameter</code> està sobrecarregat per establir tot tipus de dades.</p>
</div>
<h3 id="42-parametres-nominals">4.2. Paràmetres nominals</h3>
<p>Les posicions estan bé, però si podem indicar els paràmetres de manera nominal, el programa serà molt més llegible. Els paràmetres s'indiquen amb <code>:nomDelParametre</code> i s'assignaran amb el mètode <code>setParameter(nomDelParametre, valor)</code>, indicant el nom del paràmetre (sense els dos punts):</p>
<h3 id="43-consultes-amb-nom">4.3. Consultes amb nom</h3>
<p>Podem escriure consultes en els nostres mètodes segons les necessitem. No obstant això, és una bona pràctica crear les consultes més importants o que preveiem que seran les més utilitzades juntament amb la mateixa classe, a través del mecanisme que es presenta a continuació. En aquesta secció creem i <strong>etiquetem</strong> les nostres consultes, dins d'una col·lecció de consultes, i després les podem cridar. És com si creéssim una biblioteca de consultes.</p>
<p>Fora de la definició de la classe, es crearà una col·lecció <code>@NamedQueries</code>, que contindrà un array (indicat per claus) d'elements <code>@NamedQuery</code>, cadascun d'ells amb un <strong>nom</strong> i una definició de <strong>consulta</strong>.</p>
<p>Per invocar-les, en lloc de crear un objecte <code>Query</code>, el crearem a través d'una <code>NamedQuery</code>, indicant el seu nom i assignant paràmetres, si n'hi ha.</p>
<p>A la classe Alumno:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nd">@Entity</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Alumno&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">catalog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DocenciaConsultas&quot;</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="nd">@NamedQueries</span><span class="p">({</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Repetidores&quot;</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">            </span><span class="n">query</span><span class="o">=</span><span class="s">&quot;select a from Student a where a.repeater=true &quot;</span><span class="p">),</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;AlumnosEntre&quot;</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">            </span><span class="n">query</span><span class="o">=</span><span class="s">&quot;select a from Student a where a.age between :min and :max&quot;</span><span class="p">),</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="nd">@NamedQuery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;AlumnosDescAge&quot;</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">            </span><span class="n">query</span><span class="o">=</span><span class="s">&quot;select a from Student a order by a.age desc&quot;</span><span class="p">)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="p">})</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Alumno</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">Serializable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="o">=</span><span class="mi">13L</span><span class="p">;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="w">  </span><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p>Quan volem utilitzar-lo, en lloc de crear una <code>Query</code> hem de crear una <code>NamedQuery</code>, de la següent manera:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">Query</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s">&quot;Repetidores&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Alumno</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Alumnos repetidores: &quot;</span><span class="p">);</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Alumno</span><span class="o">&gt;</span><span class="w"> </span><span class="n">losAlumnos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="na">list</span><span class="p">();</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s">&quot;AlumnosEntre&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Alumno</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="n">q</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;min&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="n">q</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;max&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">);</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">laSesion</span><span class="p">.</span><span class="na">createNamedQuery</span><span class="p">(</span><span class="s">&quot;AlumnosDescAge&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Alumno</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Alumnos de mayor a menor: &quot;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h2 id="5-crud">5. CRUD</h2>
<p>Finalment, analitzarem la resta de les operacions CRUD. Cal destacar que aquestes operacions es poden realitzar directament sobre els objectes, per això s'expliquen com a complementàries més que principals.</p>
<h3 id="51-crear-create-insert">5.1. Crear (Create - Insert)</h3>
<p>Si volem inserir un nou objecte a la base de dades, és molt fàcil, com podem recordar en les primeres seccions d'aquesta unitat.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">Alumno</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Alumno</span><span class="p">();</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">a</span><span class="p">.</span><span class="na">setApellidos</span><span class="p">(</span><span class="s">&quot;Hamilton&quot;</span><span class="p">);</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="n">a</span><span class="p">.</span><span class="na">setNombre</span><span class="p">(</span><span class="s">&quot;Lewis&quot;</span><span class="p">);</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">a</span><span class="p">.</span><span class="na">setEdad</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">a</span><span class="p">.</span><span class="na">setRepetidor</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="n">laSesion</span><span class="p">.</span><span class="na">persist</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Simplement creem un nou objecte, establim els seus valors, mitjançant setters o el constructor amb tots els arguments, i finalment l'emmagatzemem a la base de dades amb el mètode <code>persist</code>. Podeu utilitzar <code>save</code> o <code>saveOrUpdate</code> indistintament. Podeu veure algunes diferències entre ells <a href="https://javatute.com/hibernate/difference-between-save-and-persist-in-hibernate/">aquí</a>. Tots dos executen una instrucció <code>insert sql</code>.</p>
<p>De la mateixa manera que SQL, podríem inserir en una taula amb el resultat d'una consulta, com segueix:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">class</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="n">select_hql</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h3 id="52-actualitzacio-update">5.2. Actualització (Update)</h3>
<p>Per canviar el valor d'una o més propietats d'un objecte, podem carregar l'objecte de la base de dades, canviar els valors mitjançant els mètodes getters i després desar els canvis.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">Alumno</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Alumno</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="mi">7L</span><span class="p">);</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">a</span><span class="p">.</span><span class="na">setEdad</span><span class="p">(</span><span class="mi">44</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">a</span><span class="p">.</span><span class="na">setRepetidor</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="n">laSesion</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Si volem establir una actualització massiva, que afecti diversos registres a la base de dades, podríem utilitzar-ho de la mateixa manera que en SQL:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;Update from Alumno a set a.edad=a.edad+1 where a.repetidor=true&quot;</span><span class="p">);</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">howMany</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">howMany</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; alumnos actualizados&quot;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="53-eliminacio-delete">5.3. Eliminació (Delete)</h3>
<p>Com en les seccions anteriors, podríem eliminar un únic objecte o un conjunt de registres que compleixin una condició. En el cas d'un únic objecte, necessitem carregar-lo i després eliminar-lo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">Alumno</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Alumno</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="mi">7L</span><span class="p">);</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">laSesion</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Tingues en compte que l'objecte roman en memòria o fins al final del mètode, però quan la sessió es confirma, l'objecte passarà a estar <code>detached</code>. L'estat <code>detached</code> significa que aquest objecte està fora de qualsevol tipus de seguiment. No tenim la possibilitat de desar o actualitzar aquest objecte de nou.</p>
<p>Per fer una eliminació massiva, de la mateixa manera que SQL:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">Query</span><span class="w"> </span><span class="n">q</span><span class="o">=</span><span class="n">laSesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;delete from Alumno a where a.repetidor=true&quot;</span><span class="p">);</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">howMany</span><span class="o">=</span><span class="n">q</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">howMany</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; alumnos borrados&quot;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Consell</p>
<p>Recorda aquests consell generals:</p>
<ul>
<li>Aquestes sentències poden contenir paràmetres (en sentències que contenen la clàusula <code>where</code>).</li>
<li>El <code>where</code> és opcional, però eliminarà o actualitzarà tot si falta.</li>
<li>Aquestes consultes s'executen totes utilitzant <code>executeUpdate()</code>, perquè canvien l'estat de la base de dades, i retornarà un enter amb el nombre de files afectades.</li>
</ul>
</div>
<p>Has de prestar atenció a les eliminacions, ja que depenent de com hem definit les relacions (eliminacions en cascada, deixant files orfes, etc.) poden o no ocórrer, i llançar <code>java.sql.SQLIntegrityConstraintViolationException</code>.</p>
<p>Com a comentari final en aquesta secció, recorda el que s'ha dit anteriorment: en la manipulació d'objectes (eliminacions, modificacions, etc.) tenim prou eines per fer-ho sense consultes HQL. Aquestes consultes són més adequades per processar grans volums d'informació sense carregar aquesta informació al nostre programa per processar-la.</p>
<h2 id="6-apendix-estat-dels-objectes">6. Apèndix, Estat dels objectes</h2>
<p>Com hem dit al llarg d'aquesta unitat, els objectes es carreguen i es controlen pel gestor de sessions. Cada objecte podria tenir un estat dins de la sessió, i és interessant conèixer totes les possibilitats. En aquesta imatge, podeu veure tots els diferents estats i el mètode per canviar l'estat de l'objecte.</p>
<p><center><img alt="Object Status" src="../img/ObjectStatus.png" width="90%" /></center></p>
<ul>
<li><strong>transient</strong> → L'objecte té identitat (existeix en memòria), però no té una identitat persistent, o clau primària.</li>
<li><strong>persistent</strong> → L'objecte ha estat marcat per ser desat (persistit), i la identitat en memòria està relacionada amb la identitat de la base de dades. Quan carreguem un objecte de la base de dades, aquest és l'estat inicial.</li>
<li><strong>detached</strong> → L'objecte ha estat persistit recentment, però aquest context està tancat, amb el mètode <code>detach()</code>. Les operacions quan està desconnectat no es reflectiran a la base de dades.</li>
<li><strong>removed</strong> → L'objecte ha estat marcat per ser eliminat (però encara no s'ha efectuat). Quan la sessió es tanqui, serà eliminat efectivament, però podem tornar-lo a carregar i posar-lo en un context persistent.</li>
</ul>
<p>Podeu obtenir més informació <a href="https://www.baeldung.com/hibernate-session-object-states">aquí</a>.</p>
<!--

http://www.cursohibernate.es/doku.php

-->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>