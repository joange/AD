
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2_Spring_SpringBoot/">
      
      
        <link rel="next" href="../4_Spring_Security/">
      
      
      <link rel="icon" href="../../../assets/jaume.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>3. Creating API's REST - Accés a Dades</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-spring-layers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../" title="Accés a Dades" class="md-header__button md-logo" aria-label="Accés a Dades" data-md-component="logo">
      
  <img src="../../../assets/jaume.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Accés a Dades
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Creating API's REST
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="brown" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../UD5_Spring/3_API_Rest/" hreflang="ca" class="md-select__link">
              Valencià
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="Accés a Dades" class="md-nav__button md-logo" aria-label="Accés a Dades" data-md-component="logo">
      
  <img src="../../../assets/jaume.png" alt="logo">

    </a>
    Accés a Dades
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Access
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unit 1. Files
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Unit 1. Files
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/1_File_System/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. File System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/2_Reading_and_writing_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Reading and Writing Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/3_XML_Files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Working with XML Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/4_JSON_Files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Working with JSON Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/5_CSV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Arxius separats per comes. CSV
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/6_Properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Arxius de propietats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/7_Llibreries_Conversores/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Llibreries conversores
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unit 2. Connectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Unit 2. Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/1_Object_relational_impedance_mismatch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Object-relational impedance mismatch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/2_Connectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Connectors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/3_Connecting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Connecting to the database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/4_Resultset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Query results
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/5_Metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/6_CRUD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. CRUD Operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/7_Row_to_Object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. From rows to objects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unit 3. Hibernate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Unit 3. Hibernate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/1_Mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.Object mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/2_Hibernate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Introduction to Hibernate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/3_Entities_Beans/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Entities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/4_Relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/5_HQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Queries
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unit 4. OO Databases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Unit 4. OO Databases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/1_Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduction to OO Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/2_ORDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Objet-Relational Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/3_OODB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Object-Oriented Databases
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unit 5. Spring
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Unit 5. Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_Data_Access_Services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Data Access Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_Spring_SpringBoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Introduction to Spring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3. Creating API's REST
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3. Creating API's REST
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-spring-layers" class="md-nav__link">
    <span class="md-ellipsis">
      1. Spring layers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Spring layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-main-class" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. Main Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-web-layer-controller-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. Web Layer. Controller Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-services-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.3. Services Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-repository-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.4. Repository layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-model-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.5. Model layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-dto-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.6. DTO layer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      2. Design patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Design patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-mvc-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. MVC pattern.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dto-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. DTO Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-dao-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.3. DAO pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-facade-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.4. FACADE pattern
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-the-project-and-configuring-hibernate" class="md-nav__link">
    <span class="md-ellipsis">
      3. Creating the project and configuring Hibernate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creating the project and configuring Hibernate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. The model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-the-dto" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. The DTO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2. The DTO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-converting-dto-to-json" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.1. Converting DTO to JSON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      3.3. The repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      3.4. The service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      3.5. The controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.5. The controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-index" class="md-nav__link">
    <span class="md-ellipsis">
      3.5.1. Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-read-operations-get" class="md-nav__link">
    <span class="md-ellipsis">
      4. Read operations (GET)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Read operations (GET)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-get-all" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Get All
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-get-one" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Get One
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-handling-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Handling exceptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-save-operations-post" class="md-nav__link">
    <span class="md-ellipsis">
      5. Save operations (POST)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-update-operations-put" class="md-nav__link">
    <span class="md-ellipsis">
      6. Update operations (PUT)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-delete-operations-delete" class="md-nav__link">
    <span class="md-ellipsis">
      7. Delete operations (DELETE)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-exercise-complete-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      8. Exercise. Complete the server
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_Spring_Security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5_Spring_Hateoas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Spring Hateoas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6_Postman_Swagger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Test. Postman and Swagger
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unit 6. MongoDB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Unit 6. MongoDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/1_NoSQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. NoSQL databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/2_MongoDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/3_ShellOperations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Working with MongoDB: Basic shell operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/4_Queries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Mongo Queries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/5_Mongo_Java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MongoDB and Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/6_Spring_MongoDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Spring Data MongoDB y API REST
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Practices
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Practiques/APAC1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practice 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-spring-layers" class="md-nav__link">
    <span class="md-ellipsis">
      1. Spring layers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Spring layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-main-class" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. Main Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-web-layer-controller-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. Web Layer. Controller Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-services-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.3. Services Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-repository-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.4. Repository layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-model-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.5. Model layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-dto-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1.6. DTO layer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      2. Design patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Design patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-mvc-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. MVC pattern.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dto-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. DTO Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-dao-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.3. DAO pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-facade-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      2.4. FACADE pattern
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creating-the-project-and-configuring-hibernate" class="md-nav__link">
    <span class="md-ellipsis">
      3. Creating the project and configuring Hibernate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creating the project and configuring Hibernate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. The model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-the-dto" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. The DTO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2. The DTO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-converting-dto-to-json" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.1. Converting DTO to JSON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      3.3. The repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      3.4. The service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-the-controller" class="md-nav__link">
    <span class="md-ellipsis">
      3.5. The controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.5. The controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-index" class="md-nav__link">
    <span class="md-ellipsis">
      3.5.1. Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-read-operations-get" class="md-nav__link">
    <span class="md-ellipsis">
      4. Read operations (GET)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Read operations (GET)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-get-all" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Get All
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-get-one" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Get One
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-handling-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Handling exceptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-save-operations-post" class="md-nav__link">
    <span class="md-ellipsis">
      5. Save operations (POST)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-update-operations-put" class="md-nav__link">
    <span class="md-ellipsis">
      6. Update operations (PUT)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-delete-operations-delete" class="md-nav__link">
    <span class="md-ellipsis">
      7. Delete operations (DELETE)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-exercise-complete-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      8. Exercise. Complete the server
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>3. Creating API's REST</h1>

<h2 id="1-spring-layers">1. Spring layers</h2>
<p>We are learning about some design patterns that we are going to use in our application, and that are necessary to define a correct architecture in a Spring application. Therefore, the first thing we will do is define the layers of our application structure, and once we define it we will define new design patterns that we will integrate our app.</p>
<p><center><img alt="SpringLayers" src="../../../UD5_Spring/img/SpringLayers.png" width="95%" /></center></p>
<p>The idea is to create a package structure that groups the classes into 6 main packages: package that contains the main class, web layer that contains the controllers, data access layer that contains the repository, service layer, data model layer and <em>dto</em> layer. All these are included, basically in 3: web, service and repository.</p>
<p>The objective is that, with a well-defined and coupled architecture it is possible to use Dependency Injection, since it will facilitate communication and access between the different layers.</p>
<h3 id="11-main-class">1.1. Main Class</h3>
<p>Every Java application must contain a main class with a main method. Said method, in case of implementing an application with Spring, must call the run method of the <code>SpringApplication</code> class. We will leave this class in the root by default, so that we will always have it in the same place.</p>
<h3 id="12-web-layer-controller-layer">1.2. Web Layer. Controller Layer</h3>
<p>Let's now define the behavior of the application by implementing the rest of the classes. We are going to start with the highest level layer, the controllers layer, where we will expose the application's services. In our application it will be called <code>Controller</code>.</p>
<p>This layer will basically work in 3 ways:</p>
<ul>
<li>Web services consumed by applications (REST or SOAP service).</li>
<li>Views implemented with JSP, JSF, Thymeleaf, etc. This is our main case, although we will also create REST services.</li>
<li>Views with frameworks such as Vaadin, Wicket, ZK, etc.</li>
</ul>
<h3 id="13-services-layer">1.3. Services Layer</h3>
<p>Layer that is responsible for implementing the business logic, that is, all the tasks that our system is capable of performing. </p>
<p>This is one of the most important layers since all <strong>data validation operations</strong> that refer to business logic (for example, checking that a current account has a balance when making a payment) and security will be carried out here. It will be called <code>service</code>.</p>
<p>Typically, they access the data stored in the application's database through the <em>repositories</em>, do a series of operations, and send the data to the controller. We can find the following types of service:</p>
<ul>
<li>Repository Integrity Services: they are in charge of consuming information from the repository. They are easy to implement services (for example, request a list of clients).</li>
<li>Business Operability Services: they carry out specific operations for the business flow (they carry out complex operations to complete a transaction, such as a sale, storing an order, etc).</li>
<li>Security Services: dedicated to carrying out security operations</li>
<li>Management Services: dedicated to generating reports and/or statistics.</li>
</ul>
<h3 id="14-repository-layer">1.4. Repository layer</h3>
<p>Repositories are the classes in charge of managing access to data. It typically contains classes that perform <em>CRUD</em> operations using only an entity class from a domain model. It will be called <code>repository</code>.</p>
<h3 id="15-model-layer">1.5. Model layer</h3>
<p>It will contain the mappings of the database tables into classes that represent entities. The layer will be named <code>model</code>.</p>
<h3 id="16-dto-layer">1.6. DTO layer</h3>
<p>Controllers usually handle <code>DTO</code> instead of pojos or beans, due to the structure of the API or rendering in views. Therefore, we will need to implement a <em>two-way conversion between a pojo and a DTO</em> model. Later we will define, in the design patterns, what a DTO is and we will see the bidirectional conversion, called mapping. In addition, these DTO's will be in a separate layer called <code>dto</code>.</p>
<p><center><img alt="SpringLayers2" src="../../../UD5_Spring/img/SpringLayers2.png" width="65%" /></center></p>
<h2 id="2-design-patterns">2. Design patterns</h2>
<p>A design pattern is a proven solution that solves a specific type of design problem in software development. There are lots of design patterns that are divided into categories, for example: creation, structural, behavioral, interaction, etc.</p>
<p>Why use design patterns?: They allow you to have the code well organized, readable and maintainable, it also allows you to reuse code and increases scalability in your project.</p>
<p>In themselves they provide a standard terminology and a set of good practices regarding the solution of software development problems.</p>
<p>We are going to explain several of them to begin to understand what design patterns are.</p>
<h3 id="21-mvc-pattern">2.1. MVC pattern.</h3>
<p>We have already explained this pattern in the previous topic, but we are going to give it a little review.</p>
<p>It allows separating an application into 3 layers, a way of organizing and making a project scalable. The layers that we can find are:</p>
<ul>
<li><strong>Model</strong>: This layer represents everything that has to do with data access: saving, updating, obtaining data, as well as all the business logic code, basically the Java classes and part of the business logic.</li>
<li><strong>View</strong>: The view has to do with the data presentation of the model and what the user sees, usually a view is the visual representation of a model (POJO or java class). For example, the user model, which is a class in Java and whose properties are first name and last name, must belong to a view in which final user sees those properties.</li>
<li><strong>Controller</strong>: The controller is in charge of connecting the model with the views, it works as a bridge between the view and the model, the controller receives events generated by the user from the views and is in charge of directing the respective request to the model. For example, the user wants to see the customers with the last name Álvarez, the request goes to the controller and it takes care of using the appropriate model and returning that model to the view.</li>
</ul>
<p>At no time the view will directly interact with the model, this also maintains security in an application.</p>
<p>The important thing about this pattern is that it allows you to divide it into parts, which are somehow independent, so if, for example, a change is made to the model, it would not affect the view or if there is a change, it would be minimal.</p>
<h3 id="22-dto-pattern">2.2. DTO Pattern</h3>
<p>With this pattern, one of the transversal layers of architecture is designed. It solves the problem of how to allow a client to exchange data with the server without making multiple calls asking for each piece of data. For example, if we have an entity called Person and an entity called Addresses, when asking for the people and their addresses we have to make multiple calls to the server to ask for the people and the addresses of each person, building the view with this information.</p>
<p>DTO solves it by passing a lightweight object to the client with all the necessary data, together. The client can then make local requests to the object it has received.</p>
<p>To do this, Java classes are created that encapsulate the data in a package that can be transported over the network (they can implement <code>java.io.Serializable</code>, although it is not mandatory), that is, with the previous example, we would create a Java class that would carry the person and their addresses, all together in the same object.</p>
<p>These objects are used in all layers of the application, so the information is carried by all layers of the application. It is recommended to always fill in all DTO fields to avoid <code>NullPointerException</code> errors (an empty string may be better), make DTOs self-describing, use arrays or collections of DTOs when necessary, and consider methods that override <code>equals()</code>.</p>
<p>There are two variants of DTO's:</p>
<ul>
<li>Custom DTOs that represent part of a bean or bundle multiple beans.</li>
<li>Domain DTOs called "entities". A domain class is not directly accessible by the client, since, due to the separation of the MVC pattern from the view, the entities that map the database (which are the entities) cannot be accessed. For that reason, DTO copies of server domain objects (entities) are made. Clients can operate on local copies improving read and update performance.</li>
</ul>
<p>With all this, we can summarize that DTO is a very effective pattern to transmit information between a client and a server, since it allows us to create data structures independent of our data model (Entities), which allows us to create as many "views" as necessary. From a set of tables or data sources. In addition, it allows us to control the format, name and types of data with which we transmit the data to adjust to a certain requirement. Finally, if for some reason the data model changes (and with it the entities) the client will not be affected, since they will continue to receive the same DTO.</p>
<p>Next we will see how to implement the DTO pattern.</p>
<h3 id="23-dao-pattern">2.3. DAO pattern</h3>
<p>The Data Access Object (DAO) pattern, which allows separating the data access logic from the Business Objects, in such a way that the DAO encapsulates all the data access logic to the rest of the application.
This proposal proposes to completely separate the business logic from the logic to access the data, in this way, the DAO will provide the necessary methods to insert, update, delete and consult the information; on the other hand, the business layer only cares about business logic and uses the DAO to interact with the data source.
In the example that we are going to design below, we will see how to implement the DAO pattern.</p>
<h3 id="24-facade-pattern">2.4. FACADE pattern</h3>
<p>The Facade design pattern simplifies the complexity of a system through a simpler interface. Improves access to our system by allowing other systems or subsystems to use a common access point that reduces complexity, minimizing interactions and dependencies. That is, we will create a Java interface that will have the method headers as a common access point, while there will be Java classes that will implement that interface.</p>
<p>Throughout this example we will make use of this pattern.</p>
<h2 id="3-creating-the-project-and-configuring-hibernate">3. Creating the project and configuring Hibernate</h2>
<p>In this section we are going to create a simple Hibernate program with Spring, to apply all we have studied in previous units with Spring. We only have to create a new project, selecting dependencies that we usually use:</p>
<p><center><img alt="SpringRest" src="../../../UD5_Spring/img/SpringRest.png" width="95%" /></center></p>
<p>This will generate <code>pom.xml</code> with all we need</p>
<p>We need to set the parameters that we set in <code>hibernate.cfg.xml</code> in <code>application.properties</code> file:
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># puerto de escucha</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>server.port<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8090</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1"># Conexión con la BBDD</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>spring.datasource.driver-class-name<span class="o">=</span>com.mysql.cj.jdbc.Driver
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># Datos del SGBD. REVISAR !!!!</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>spring.datasource.url<span class="w"> </span><span class="o">=</span><span class="w"> </span>jdbc:mysql://localhost:3308/AD_UD5_Clientes
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>spring.datasource.username<span class="w"> </span><span class="o">=</span><span class="w"> </span>root
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>spring.datasource.password<span class="w"> </span><span class="o">=</span><span class="w"> </span>root
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="c1"># configuración de hibernate (simple)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>spring.jpa.show-sql<span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>spring.jpa.properties.hibernate.format_sql<span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>spring.jpa.properties.hibernate.dialect<span class="w"> </span><span class="o">=</span><span class="w"> </span>org.hibernate.dialect.MySQL5InnoDBDialect
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="c1"># hbm2DDL. values= none, validate, update, create, and create-drop</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>spring.jpa.hibernate.ddl-auto<span class="o">=</span>validate
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="c1"># import.sql file under src/main/resources/</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="c1"># or data.sql or schema.sql</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="c1"># respetar mayúsculas y minúsculas</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>spring.jpa.hibernate.naming.physical-strategy<span class="o">=</span>org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
</code></pre></div></td></tr></table></div></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All options of database initialization can be found in <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-initialization">database initialization</a>.</p>
</div>
<h3 id="31-the-model">3.1. The model</h3>
<p>Let's go to use this model to our practice:</p>
<p><center><img alt="DBModel" src="../../../UD5_Spring/img/DBModel.png" width="95%" /></center></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You have a script to create full database linked <a href="../../../UD5_Spring/AD_UD5_Clientes.sql">here</a>. In this unit we do not implement about <code>Movimientos</code>.</p>
</div>
<p>To create the model we have to create the Beans that we create in unit 3. We can use Lombok to improve our development time. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You con mark an attribute with Lombok annotation <code>@ToString.Exclude</code> to avoid participate in <code>toString</code> method, for instance to avoid recursion.</p>
</div>
<p><code>Cliente</code> DAO in package <code>model</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nd">@Data</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nd">@Entity</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Cliente</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="nd">@Id</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="w"> </span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;nif&quot;</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nif</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;nombre&quot;</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nombre</span><span class="p">;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">apellidos</span><span class="p">;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;claveseguridad&quot;</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">claveSeguridad</span><span class="p">;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">    </span><span class="nd">@OneToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">            </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">            </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cliente&quot;</span><span class="p">)</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">    </span><span class="nd">@ToString.Exclude</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Recomendacion</span><span class="w"> </span><span class="n">recomendacion</span><span class="p">;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">            </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">            </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cliente&quot;</span><span class="p">)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">    </span><span class="nd">@ToString.Exclude</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Cuenta</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listaCuentas</span><span class="p">;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">  </span><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">})</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">  </span><span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;clientesdirecciones&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">              </span><span class="n">joinColumns</span><span class="o">=</span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;idcliente&quot;</span><span class="p">),</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">              </span><span class="n">inverseJoinColumns</span><span class="o">=</span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;iddireccion&quot;</span><span class="p">))</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">  </span><span class="nd">@ToString.Exclude</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Direccion</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listaDirecciones</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h3 id="32-the-dto">3.2. The DTO</h3>
<p>The DTO's (<strong>Data Transfer Object</strong>) serves to transfer data in our system through transactions carried out by our entities from one operation to another without losing the integrity between the data.</p>
<p>For this reason, it is important to define that data access is done only through DAO (Data Access Object) our <code>model</code>, thereby obtaining an abstraction of the data model. The data is only accessed through methods defined in the <code>DAO</code>. The DAOs include another concept that is the DTO (Data Transfer Object). DTO's are a class of objects that serve solely to transport data. DTO contains the properties of the object. Data that may originate from one or more information entities.</p>
<p>Another good practice is to mark the classes with the DTO suffix to remember its meaning, so the <code>Client</code> class would remain as <code>ClientDTO</code>.</p>
<p>One of the characteristics of the DTO's is that they must be <code>Serializable</code> objects in order to be able to travel through the network. We need to indicate this feature in the DTO's, so we are going to add that they implement the Serializable interface, and with it, the <code>UID</code> property that identifies the version of each transported object. </p>
<p>To create a DTO we will create a class with the attributes that we want containing the DTO. It can be more or less than DAO class. Then is important to create methods to convert either between DAO to DTO as DTO to DAO. These methods can be created in a static way.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1">// Convierte una entidad DAO a un objeto DTO con todos los datos</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">convertToDTO</span><span class="p">(</span><span class="n">Cliente</span><span class="w"> </span><span class="n">cliente</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="c1">// Creamos el clienteDTO y asignamos los valores basicos</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clienteDTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="p">();</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setIdCliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setNif</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getNif</span><span class="p">());</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setNombre</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getNombre</span><span class="p">());</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setApellidos</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getApellidos</span><span class="p">());</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1">// rest of attributes</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">clienteDTO</span><span class="p">;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="p">}</span><span class="w">       </span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="c1">// Convierte de un objeto a un entidad</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Cliente</span><span class="w"> </span><span class="nf">convertToEntity</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clientedto</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="n">Cliente</span><span class="w">  </span><span class="n">cliente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cliente</span><span class="p">();</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">        </span><span class="n">cliente</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">clientedto</span><span class="p">.</span><span class="na">getIdCliente</span><span class="p">());</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">        </span><span class="n">cliente</span><span class="p">.</span><span class="na">setNif</span><span class="p">(</span><span class="n">clientedto</span><span class="p">.</span><span class="na">getNif</span><span class="p">());</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="c1">// rest of attributes</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cliente</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>As we say, we prevent to access entities from higher layers.</p>
<div class="admonition tip">
<p class="admonition-title">More...</p>
</div>
<p>You can search the internet for information about <code>ModelMapper</code> to manage DTOs.</p>
<h4 id="321-converting-dto-to-json">3.2.1. Converting DTO to JSON</h4>
<p>As we have said, these objects (DTO's ) are parsed to JSON automaticaly, but how? Spring uses Jackson object mapper to transform objects to JSON Objects. In <a href="https://www.baeldung.com/jackson-object-mapper-tutorial">this tutorial</a> you can understand better how it works.</p>
<p>Parsing objects to JSON can take us to another infinite recursion problem, when object contains cross-references, like <code>toString()</code> methods. We have learnt how to avoid the <code>StackOverflowException</code> in <code>toString()</code> methods, using Lombok <code>@ToString.Exclude</code>, but how to avoid when parsoing to JSON. The solution is offered with new annotations, as follows:</p>
<ul>
<li><code>@JsonIgnore</code> → this field will not be parsed.</li>
<li><code>@JsonManagedReference</code> → tell that we will show this object information in forward way, but not in a backward mode. This annotation will be complemented by:</li>
<li><code>@JsonBackReference</code> → Show the referenced information only, similar of <code>@JsonIgnore</code>.</li>
<li><code>@JsonIgnoreProperties("property")</code> → skip this property in the annotated field.</li>
</ul>
<p>If we mark:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">class</span> <span class="nc">Director</span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="c1">// own attributes</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="nd">@JsonManagedReference</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Film</span><span class="o">&gt;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="p">}</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="kd">class</span> <span class="nc">Film</span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">  </span><span class="c1">// own attributes</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">  </span><span class="nd">@JsonBackReference</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">  </span><span class="n">Director</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We will show the Film information of a Director without recurssion (only own attributes)</p>
<p>You can find more information <a href="https://www.baeldung.com/jackson-bidirectional-relationships-and-infinite-recursion">here</a></p>
<h3 id="33-the-repository">3.3. The repository</h3>
<p>The repository layer is responsible for managing access to data. This makes it possible to separate the business logic from the data access, thus allowing, for example, to be able to modify the system database without affecting the logic.</p>
<p>In this layer we must distinguish two types of access:</p>
<ul>
<li>Access to data from the system's own data model that will be done through DAO (Data Access Object) access. For this type of access, we will use the JPA (Java Persistence API) framework through Spring Data.</li>
<li>Access to external systems through connectors (webservices, APIs, etc.)</li>
</ul>
<p>For this reason we are going to create an interface in which we have the operations that we are going to expose. This interface will be <code>ClientRepository.java</code> and will be created in the <code>repository</code> package.</p>
<p>With Spring, we will save a lot of work, since we will simply define a working interface, in which we will indicate the type of repository that we want to create, the class on which it is going to work and the type of data that works as an identifier of said class:</p>
<p>Spring provides the <em>Repository Interface</em>, from which it inherits <code>CrudRepository</code>, which includes the definition of the basic CRUD operations. From the latter it inherits <code>PagingAndSortingRepository</code>, which adds paging and ordering functions, and finally we have <code>JPARepository</code>, which includes specific operations for JPA.</p>
<p>The importance of the generic definition of <code>Repository&lt;Class,Type&gt;</code> is that all the objects it will retrieve are of that class, and the type indicates the type of the primary key of that class. Following our example, the repository definition would be:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nd">@Repository</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="nd">@Transactional</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ClienteRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Cliente</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With this, Spring already allows us to access the database and perform basic operations. The following methods are implemented by default, and we will not need to implement them, just define them:</p>
<ul>
<li><strong>Recover data</strong>:</li>
<li><code>findAll()</code>, <code>findById(Id)</code>, <code>findById(Iterable&lt;Id&gt;)</code>:retrieves one, or all, occurrences of an identifier or a collection of identifiers.</li>
<li><strong>Delete data</strong>:</li>
<li><code>delete(Object)</code>, <code>deleteAll()</code>, <code>deleteById(Id)</code>, <code>deleteAllById(Iterable&lt;Id&gt;)</code>:delete by object, identifier or all.</li>
<li><strong>count and check</strong>:</li>
<li><code>count()</code>, <code>existsById()</code></li>
<li><strong>save objects</strong>:</li>
<li><code>save(Object)</code>, <code>save(Iterable&lt;Object&gt;)</code>:save the object(s)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If we need another method, we must define it, and then create a new class to implement this interface and implement the method.</p>
</div>
<h3 id="34-the-service">3.4. The service</h3>
<p>The service layer manages the business logic of our application. This business logic is separate from the web logic, which is in the controller.</p>
<p>When we define classes that implement services for business logic, the following rules must be followed:</p>
<ol>
<li>Define an interface that will have the headers of the methods that you want to publish. In this way we make use of the <strong>Facade pattern</strong> and expose the methods of the service to use.</li>
<li>We define a class (bear in mind that an interface can have several classes that implement it) that implements the interface, so that we can implement all the service methods following the required business logic.</li>
<li>The <code>@Service</code> annotation tells Spring to recognize the class as a service (similar to the <code>@Controller</code> annotation that we have studied in previous section).</li>
<li>We will use <code>@Autowired</code> to inject the service into the controller (we will see later).</li>
<li>We will use <code>@Autowired</code> to inject DAO with which we are going to work into the service.</li>
<li>Keep in mind that a service method will define a business level operation, eg giving a welcome message. Service methods will be made up of other smaller operations, which will be defined in the repository layer.</li>
</ol>
<p>With all this, we are going to begin to define the service layer. So we start by creating an interface called <code>ClientService.java</code> in the <code>service</code> package. </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span>
<span class="normal"><a href="#__codelineno-5-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ClienteService</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveCliente</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clienteDTO</span><span class="p">);</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">getClienteById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listAllClientes</span><span class="p">();</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteCliente</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Notice that we define in this case 4 basic operations with <code>ClienteDTO</code>, due to is the objects will manage the controller.</p>
<p>Once we have the interface, we create a new class called <code>ClientServiceImpl.java</code>, which will be in charge of implementing the methods that are declared in the interface. After that, we make the new class extend the created interface and after that we make it implement all the methods of the interface by default. We also indicate the <code>@Service</code> annotation to the class. It will be as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nd">@Service</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClienteServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ClienteService</span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ClienteRepository</span><span class="w"> </span><span class="n">clienteRepository</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveCliente</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clienteDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">        </span><span class="n">Cliente</span><span class="w"> </span><span class="n">cliente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="p">.</span><span class="na">convertToEntity</span><span class="p">(</span><span class="n">clienteDTO</span><span class="p">);</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">        </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">cliente</span><span class="p">);</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">getClienteById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Cliente</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cliente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="p">.</span><span class="na">convertToDTO</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">            </span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listAllClientes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Cliente</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lista</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listaResultado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lista</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">            </span><span class="n">listaResultado</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="p">.</span><span class="na">convertToDTO</span><span class="p">(</span><span class="n">lista</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">listaResultado</span><span class="p">;</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteCliente</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">        </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>As you can see, the service is in charge of invoking the repository methods, and performing some checks if necessary. Furthermore, we get <code>Cliente</code> objects and transform it to <code>ClienteDTO</code>, in order to use it to return to the controller.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code>findClienteById()</code> method returns a new wrapper class <code>Optional&lt;Cliente&gt;</code>. This class wraps an Object that will exist or no, providing methods to check it and act in consequence:</p>
</div>
<ul>
<li><code>isPresent()</code> → returns a boolean.</li>
<li><code>orElse(anotherObject)</code> → if not exists, return another Object instead of Optional.</li>
<li><code>get()</code> → returns existing object.</li>
</ul>
<p>The main goal is to avoid famous <code>NullPointerException</code>. More information can be found <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Optional.html">here</a></p>
<h3 id="35-the-controller">3.5. The controller</h3>
<p>We are now going to define the highest level layer, the controllers layer, where we will expose the application's services.</p>
<p>The controller will be in charge of responding to user requests with the application. It will include the services, and in case of creating an MVC application, it will be able to invoke template engines, such as <em>Thymeleaf</em>. As we have commented here we will implement it in a single class (without following the previous pattern).</p>
<p>The controller will invoke the service associated with said request and return the data obtained or the response to the same client. We must mark the class with the <code>@Controller</code> stereotype. In the case of REST services, we must also indicate that the returns of the class methods are serialized to JSON, and we achieve this with <code>@ResponseBody</code>. Since Spring 4, the two annotations have been merged into one, via <code>@RestController</code>. We will only leave <code>@Controller</code> for projects where we return a view (HTML + CSS + JS).</p>
<p>The service that we are going to create will have a complete behavior in terms of <code>Cliente</code> maintenance, as well as their recommendation, so we can list customers, view their information, register customers, update customer data and delete customers, or be the CRUD operations that are known.</p>
<p>So we'll start by creating a controller called <code>ClienteController.java</code>. This controller will implement the 4 operations corresponding to CRUD: create, read, update and delete. Apart from these 4 we will create an operation that will show the initial page of the application, with a link to customer maintenance.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nd">@RestController</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClienteController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ClienteService</span><span class="w"> </span><span class="n">clienteService</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="c1">// mapping the requests. One method per route/request</span>
</code></pre></div></td></tr></table></div>
<p>The controller normally defines four CRUD operations, but we can add all that we need. Let's go to see it.</p>
<h4 id="351-index">3.5.1. Index</h4>
<p>This method maps the root index of our webapp, For instance, we can send name of the application and module. These variables could be defined in our <code>application.properties</code> and can be loaded with <code>@Value</code> annotation and a String <code>${property_name}</code> inside.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nd">@Autowired</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${app.name}&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">appName</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${developer.name}&quot;</span><span class="p">)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">devName</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>The index controller normally shows general information about the main page, as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="s">&quot;Hello from Spring\n&quot;</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span><span class="n">res</span><span class="o">+=</span><span class="s">&quot;You are running &quot;</span><span class="w"> </span><span class="o">+</span><span class="n">appName</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">  </span><span class="n">res</span><span class="o">+=</span><span class="s">&quot;Developed by &quot;</span><span class="w"> </span><span class="o">+</span><span class="n">devName</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="4-read-operations-get">4. Read operations (<strong>GET</strong>)</h2>
<p>It's time to retrieve data from our server, and normally <code>GET</code> operations are the most demanded methods. We are going to implement several methods, that could return one or many objects of the desired class, in our notes, <code>Cliente</code> class.</p>
<h3 id="41-get-all">4.1. Get All</h3>
<p>No filter option is needed, because we want to get all clients. When we get this <em>get</em> request, we must call to <code>listAll</code> method in our service, who calls, indeed to <code>findAll</code> in our repository.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listClientes</span><span class="p">(){</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRemoteHost</span><span class="p">());</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">losClientes</span><span class="o">=</span><span class="n">clienteService</span><span class="p">.</span><span class="na">listAllClientes</span><span class="p">();</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">losClientes</span><span class="p">;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>Apart from log message, we simply retrieve data from the service and return it to the response.</p>
<h3 id="42-get-one">4.2. Get One</h3>
<p>This is the most specific version, and normally in the request we look for an object from its ID. Then, we must get a parameter in our request, and we will use the ID in the path, using <code>@PathVariable</code> annotation.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/clientes/{idCliente}&quot;</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">showClienteById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCliente</span><span class="p">){</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRemoteHost</span><span class="p">());</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="n">clienteService</span><span class="p">.</span><span class="na">getClienteById</span><span class="p">(</span><span class="n">idCliente</span><span class="p">);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">elCliente</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>The request will be <code>/clientes/7</code>, for instance, and then, in our controller method the parameter <code>idCliente</code>will be set with 7 value. We call <code>getClienteById(7)</code> and, obviously we get the <code>ClienteDTO</code> encapsulating the requested <code>Cliente</code>, if exists.</p>
<p>We can improve the methods for the case that there are no results (<code>Cliente</code> does not exists) or an error has occurred, returning and encapsulating the results in a <code>ResponseEntity&lt;Cliente&gt;</code>. This wrapper class returns the result to the request, but allows adding an argument that will be the <strong>http status code</strong>. This code can be captured on the client application for error handling. The algorithm will be something like this:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">results</span><span class="o">&gt;</span><span class="n">controllerMethod</span><span class="p">(){</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="c1">// collect the data from the service/repository</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">mistake</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">Results</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span><span class="w"> </span><span class="c1">// ALL GOOD</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span><span class="w"> </span><span class="c1">// SOMETHING IS WRONG</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>applied to our sample application, and merging last two code samplers, will get as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/clientes/{idCliente}&quot;</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">showClienteById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCliente</span><span class="p">){</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRemoteHost</span><span class="p">());</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="n">clienteService</span><span class="p">.</span><span class="na">getClienteById</span><span class="p">(</span><span class="n">idCliente</span><span class="p">);</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elCliente</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">  </span><span class="k">else</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">elCliente</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<h3 id="43-handling-exceptions">4.3. Handling exceptions</h3>
<p>The controller handle several exceptions, and the program continues running unless a big crush occurs. Now we present a method that will give a response when an exception happens. We will annotate this method with <code>@ExceptionHandler</code>, passing the exception class that we must catch</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">MethodArgumentTypeMismatchException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handleError</span><span class="p">(</span><span class="n">MethodArgumentTypeMismatchException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Method Argument Type Mismatch&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Method Argument Type Mismatch: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">);</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We can handle several exceptions in one unique method, marking it with a collection of exceptions, for instance as:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nd">@ExceptionHandler</span><span class="p">({</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="n">MissingServletRequestParameterException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="n">MethodArgumentTypeMismatchException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="n">InvalidStreamDefinitionException</span><span class="p">.</span><span class="na">class</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="p">})</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handleError</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="c1">// method body</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="c1">// i aquest quan no es troba una entrada al controlador</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">NoHandlerFoundException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">handleNotFoundError</span><span class="p">(</span><span class="n">NoHandlerFoundException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;404 Not Found&quot;</span><span class="p">);</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;El recurso solicitado no existe.&quot;</span><span class="p">);</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getRequestURL</span><span class="p">());</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="5-save-operations-post">5. Save operations (<strong>POST</strong>)</h2>
<p>First operation we need to do is to store new <code>Cliente</code> on our database. Let's go to explain by example. The controller will receive a new DTO object sent by the client app (we will use Postman, as you can view in <em>Appendix 1</em>):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1">//@PostMapping(value=&quot;/clientes&quot;,consumes={&quot;application/json&quot;})</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addDirector</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">newCliente</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">());</span><span class="w"> </span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="w"> </span><span class="n">clienteService</span><span class="p">.</span><span class="na">saveCliente</span><span class="p">(</span><span class="n">newCliente</span><span class="p">);</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elCliente</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">);</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">elCliente</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>notice that:</p>
<ul>
<li>The request is mapped with <code>@PostMapping</code>. Here you have a comment with extra options.</li>
<li>The object received by the app is inside a JSON object in the request body, marked as <code>@RequestBody</code>. In this unit we are going to suppose that the data arrives well formatted.</li>
<li>Data received is passed to service and a new (stored) <code>Cliente</code> is returned. </li>
<li>This client is returned to the client</li>
</ul>
<p>In this picture you can view data sent to API and returned value. Notice that <code>Cuentas</code> and <code>Direcciones</code> are not present in that data. We will see later how to add this additional data.</p>
<p><center><img alt="Post_Cliente" src="../../../UD5_Spring/img/Post_Cliente.png" width="95%" /></center></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There is a lot of validations to do in order to verify data integrity. <a href="https://www.baeldung.com/spring-boot-bean-validation">Here</a> you can find an article about ho to validate data recieved from client applications.</p>
</div>
<h2 id="6-update-operations-put">6. Update operations (<strong>PUT</strong>)</h2>
<p>To update an object of the database, we need to receive the update (<strong>and complete</strong>) object in the request. We can not save it immediately, because it could not exist. For this reason we must check the existence, and if this is positive, then save the object received, that will update previous version in the database. Let's go to see the sample:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nd">@PutMapping</span><span class="p">(</span><span class="s">&quot;/clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateCliente</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">updCliente</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">());</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="c1">// buscamos si existe previamente</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="w"> </span><span class="n">clienteService</span><span class="p">.</span><span class="na">getClienteById</span><span class="p">(</span><span class="n">updCliente</span><span class="p">.</span><span class="na">getIdCliente</span><span class="p">());</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elCliente</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">        </span><span class="c1">// como ya sabemos que existe, save actualiza</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">        </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elClienteUPD</span><span class="o">=</span><span class="w"> </span><span class="n">clienteService</span><span class="p">.</span><span class="na">saveCliente</span><span class="p">(</span><span class="n">updCliente</span><span class="p">);</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">elClienteUPD</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="7-delete-operations-delete">7. Delete operations (<strong>DELETE</strong>)</h2>
<p>Delete is very simple operation, because we only need the object's identifier that we want to delete, and then we could get from the path, inside the path variable. Then, we must call th delete operation of the service.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nd">@DeleteMapping</span><span class="p">(</span><span class="s">&quot;/clientes/{idCliente}&quot;</span><span class="p">)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">deleteCliente</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCliente</span><span class="p">){</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">  </span><span class="n">clienteService</span><span class="p">.</span><span class="na">deleteCliente</span><span class="p">(</span><span class="n">idCliente</span><span class="p">);</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;Cliente borrado satisfactoriamenet&quot;</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<h2 id="8-exercise-complete-the-server">8. Exercise. Complete the server</h2>
<p>We have finished creating our controller about <code>Cliente</code> class, but we can improve our application adding more services and configurations to the server. This concepts will be studied in next sections.</p>
<p>We recommend completing <code>Cuenta</code> and <code>Direccion</code> controller, services and repositories with default operations.</p>
<p>Furthermore, you can add options to add a <code>Cuenta</code> to a <code>Cliente</code> or remove, and same as <code>Direccion</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>