
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2_Spring_SpringBoot/">
      
      
        <link rel="next" href="../4_Spring_Security/">
      
      
      <link rel="icon" href="../../assets/jaume.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>3. Creació de APIs REST - Accés a Dades</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-nivells-capes-de-spring" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="../.." title="Accés a Dades" class="md-header__button md-logo" aria-label="Accés a Dades" data-md-component="logo">
      
  <img src="../../assets/jaume.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Accés a Dades
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Creació de APIs REST
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="brown" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Selecciona la llengua">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../en/UD5_Spring/3_API_Rest/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="ca" class="md-select__link">
              Valencià
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Accés a Dades" class="md-nav__button md-logo" aria-label="Accés a Dades" data-md-component="logo">
      
  <img src="../../assets/jaume.png" alt="logo">

    </a>
    Accés a Dades
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accés a Dades - Informació del mòdul
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 1. Fitxers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Unitat 1. Fitxers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/1_File_System/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Sistema de Fitxers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/2_Reading_and_writing_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Llegint i Escrivint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/3_XML_Files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Treball amb Arxius XML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/4_JSON_Files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Treball amb Arxius JSON
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD1_Files/5_Extra_Formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Altres formats de Fitxers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 2. Connectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Unitat 2. Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/1_Object_relational_impedance_mismatch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Desfase objecte-relacional
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/2_Connectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Connectors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/3_Connecting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Connectant-se a la base de dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/4_Resultset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Resultats de les consultes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/5_Metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Metadades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/6_CRUD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Operacions CRUD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD2_Connectors/7_Row_to_Object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. De les files als objectes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 3. Hibernate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Unitat 3. Hibernate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/1_Mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Mapeig d'objectes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/2_Hibernate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Introduccio a Hibernate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/3_Entities_Beans/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Entitats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/4_Relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Relacions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD3_Hibernate/5_HQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Consultes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 4. Bases de Dades OO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Unitat 4. Bases de Dades OO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/1_Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduccio a les bases de dades OO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/2_ORDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Bases de dades Objecte-Relacionals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD4_BDOO/3_OODB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Bases de dades Orientades a Objectes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 5. Spring
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Unitat 5. Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_Data_Access_Services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Serveis d'Acces a Dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_Spring_SpringBoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Introducció a Spring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3. Creació de APIs REST
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3. Creació de APIs REST
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-nivells-capes-de-spring" class="md-nav__link">
    <span class="md-ellipsis">
      1. Nivells (capes) de Spring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Nivells (capes) de Spring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-classe-main" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. Classe Main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-capa-web-capa-de-controladors" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. Capa Web. Capa de Controladors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-capa-de-serveis" class="md-nav__link">
    <span class="md-ellipsis">
      1.3. Capa de Serveis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-capa-de-repositori" class="md-nav__link">
    <span class="md-ellipsis">
      1.4. Capa de Repositori
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-capa-de-model" class="md-nav__link">
    <span class="md-ellipsis">
      1.5. Capa de Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-capa-dto" class="md-nav__link">
    <span class="md-ellipsis">
      1.6. Capa DTO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-patrons-de-disseny" class="md-nav__link">
    <span class="md-ellipsis">
      2. Patrons de Disseny
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Patrons de Disseny">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-patro-mvc" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. Patró MVC.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-patro-dto" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. Patró DTO.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-patro-dao" class="md-nav__link">
    <span class="md-ellipsis">
      2.3. Patró DAO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-patro-facade-facana" class="md-nav__link">
    <span class="md-ellipsis">
      2.4. Patró FACADE (façana)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creacio-del-projecte-i-configuracio-de-hibernate" class="md-nav__link">
    <span class="md-ellipsis">
      3. Creació del projecte i configuració de Hibernate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creació del projecte i configuració de Hibernate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-el-model" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. El model.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-el-dto" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. El DTO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2. El DTO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-convertint-dto-a-json" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.1. Convertint DTO a JSON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-el-repositori" class="md-nav__link">
    <span class="md-ellipsis">
      3.3. El repositori
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-el-servei" class="md-nav__link">
    <span class="md-ellipsis">
      3.4. El servei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-el-controlador" class="md-nav__link">
    <span class="md-ellipsis">
      3.5. El controlador
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.5. El controlador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-index" class="md-nav__link">
    <span class="md-ellipsis">
      3.5.1. Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-operacions-de-lectura-get" class="md-nav__link">
    <span class="md-ellipsis">
      4. Operacions de lectura (GET)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Operacions de lectura (GET)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-obtenir-tots" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Obtenir tots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-obtenir-un" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Obtenir Un
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-gestio-dexcepcions" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Gestió d'excepcions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-operacions-de-guardat-post" class="md-nav__link">
    <span class="md-ellipsis">
      5. Operacions de guardat (POST)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-operacions-dactualitzacio-put" class="md-nav__link">
    <span class="md-ellipsis">
      6. Operacions d'actualització (PUT)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-operacions-deliminacio-delete" class="md-nav__link">
    <span class="md-ellipsis">
      7. Operacions d'eliminació (DELETE)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-exercici-completa-el-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      8. Exercici. Completa el servidor
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_Spring_Security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Seguretat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5_Spring_Hateoas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Spring Haetoas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6_Postman_Swagger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Test. Postman i Swagger
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unitat 6. MongoDB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Unitat 6. MongoDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/1_NoSQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Bases de dades NoSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/2_MongoDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. MongoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/3_ShellOperations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Treballant amb MongoDB: Operacions bàsiques de shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/4_Queries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Consultese en Mongo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/5_Mongo_Java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MongoDB i Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UD6_MongoDB/6_Spring_MongoDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Spring Data MongoDB i API REST
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llicència
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-nivells-capes-de-spring" class="md-nav__link">
    <span class="md-ellipsis">
      1. Nivells (capes) de Spring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Nivells (capes) de Spring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-classe-main" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. Classe Main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-capa-web-capa-de-controladors" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. Capa Web. Capa de Controladors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-capa-de-serveis" class="md-nav__link">
    <span class="md-ellipsis">
      1.3. Capa de Serveis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-capa-de-repositori" class="md-nav__link">
    <span class="md-ellipsis">
      1.4. Capa de Repositori
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-capa-de-model" class="md-nav__link">
    <span class="md-ellipsis">
      1.5. Capa de Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-capa-dto" class="md-nav__link">
    <span class="md-ellipsis">
      1.6. Capa DTO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-patrons-de-disseny" class="md-nav__link">
    <span class="md-ellipsis">
      2. Patrons de Disseny
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Patrons de Disseny">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-patro-mvc" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. Patró MVC.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-patro-dto" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. Patró DTO.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-patro-dao" class="md-nav__link">
    <span class="md-ellipsis">
      2.3. Patró DAO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-patro-facade-facana" class="md-nav__link">
    <span class="md-ellipsis">
      2.4. Patró FACADE (façana)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-creacio-del-projecte-i-configuracio-de-hibernate" class="md-nav__link">
    <span class="md-ellipsis">
      3. Creació del projecte i configuració de Hibernate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creació del projecte i configuració de Hibernate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-el-model" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. El model.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-el-dto" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. El DTO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2. El DTO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-convertint-dto-a-json" class="md-nav__link">
    <span class="md-ellipsis">
      3.2.1. Convertint DTO a JSON
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-el-repositori" class="md-nav__link">
    <span class="md-ellipsis">
      3.3. El repositori
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-el-servei" class="md-nav__link">
    <span class="md-ellipsis">
      3.4. El servei
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-el-controlador" class="md-nav__link">
    <span class="md-ellipsis">
      3.5. El controlador
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.5. El controlador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#351-index" class="md-nav__link">
    <span class="md-ellipsis">
      3.5.1. Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-operacions-de-lectura-get" class="md-nav__link">
    <span class="md-ellipsis">
      4. Operacions de lectura (GET)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Operacions de lectura (GET)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-obtenir-tots" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Obtenir tots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-obtenir-un" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Obtenir Un
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-gestio-dexcepcions" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Gestió d'excepcions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-operacions-de-guardat-post" class="md-nav__link">
    <span class="md-ellipsis">
      5. Operacions de guardat (POST)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-operacions-dactualitzacio-put" class="md-nav__link">
    <span class="md-ellipsis">
      6. Operacions d'actualització (PUT)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-operacions-deliminacio-delete" class="md-nav__link">
    <span class="md-ellipsis">
      7. Operacions d'eliminació (DELETE)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-exercici-completa-el-servidor" class="md-nav__link">
    <span class="md-ellipsis">
      8. Exercici. Completa el servidor
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>3. Creació de APIs REST</h1>

<h2 id="1-nivells-capes-de-spring">1. Nivells (capes) de Spring</h2>
<p>Estem aprenent sobre alguns patrons de disseny que utilitzarem en la nostra aplicació, i que són necessaris per definir una arquitectura correcta en una aplicació Spring. Per tant, la primera cosa que farem és definir les capes de l'estructura de la nostra aplicació, i un cop les definim, definirem nous patrons de disseny que integrarem a la nostra aplicació.</p>
<p><center><img alt="SpringLayers" src="../img/SpringLayers.png" width="95%" /></center></p>
<p>La idea és crear una estructura de paquets que agrupi les classes en 6 paquets principals: paquet que conté la classe principal, capa web que conté els controladors, capa d'accés a dades que conté el repositori, capa de servei, capa de model de dades i capa <em>dto</em>. Tots aquests estan inclosos, bàsicament en 3: web, servei i repositori.</p>
<p>L'objectiu és que, amb una arquitectura ben definida i acoblada, sigui possible utilitzar la Injecció de Dependències, ja que facilitarà la comunicació i l'accés entre les diferents capes.</p>
<h3 id="11-classe-main">1.1. Classe Main</h3>
<p>Cada aplicació Java ha de contenir una classe principal amb un mètode <em>main</em>. Aquest mètode, en cas d'implementar una aplicació amb Spring, ha de cridar el mètode run de la classe <code>SpringApplication</code>. Deixarem aquesta classe a l'arrel per defecte, de manera que sempre la tindrem al mateix lloc.</p>
<h3 id="12-capa-web-capa-de-controladors">1.2. Capa Web. Capa de Controladors</h3>
<p>Ara definirem el comportament de l'aplicació implementant la resta de les classes. Començarem amb la capa de més alt nivell, la capa de controladors, on exposarem els serveis de l'aplicació. En la nostra aplicació es dirà <code>Controller</code>.</p>
<p>Aquesta capa bàsicament contindrà 3 parts:</p>
<ul>
<li>Serveis web consumits per aplicacions (servei REST o SOAP).</li>
<li>Vistes implementades amb JSP, JSF, Thymeleaf, etc. Aquest és el nostre cas principal, tot i que també crearem serveis REST.</li>
<li>Vistes amb frameworks com Vaadin, Wicket, ZK, etc.</li>
</ul>
<h3 id="13-capa-de-serveis">1.3. Capa de Serveis</h3>
<p>Capa que s'encarrega d'implementar la lògica de negoci, és a dir, totes les tasques que el nostre sistema és capaç de realitzar. És la el·laboració del que ofereix el controlador.</p>
<p>Aquesta és una de les capes més importants ja que aquí es duran a terme totes les <strong>operacions de validació de dades</strong> que fan referència a la lògica de negoci (per exemple, comprovar que un compte corrent té saldo en fer un pagament) i la seguretat. Es dirà <code>service</code>.</p>
<p>Normalment, accedeixen a les dades emmagatzemades a la base de dades de l'aplicació a través dels <em>repositories</em>, fan una sèrie d'operacions i envien les dades al controlador. Podem trobar els següents tipus de servei:</p>
<ul>
<li>Serveis d'Integritat de Repositoris: s'encarreguen de consumir informació del repositori. Són serveis fàcils d'implementar (per exemple, sol·licitar una llista de clients).</li>
<li>Serveis d'Operabilitat de Negoci: realitzen operacions específiques per al flux de negoci (realitzen operacions complexes per completar una transacció, com una venda, emmagatzemar una comanda, etc).</li>
<li>Serveis de Seguretat: dedicats a realitzar operacions de seguretat.</li>
<li>Serveis de Gestió: dedicats a generar informes i/o estadístiques.</li>
</ul>
<h3 id="14-capa-de-repositori">1.4. Capa de Repositori</h3>
<p>Els repositoris són les classes encarregades de gestionar l'accés a les dades. Normalment contenen classes que realitzen operacions <em>CRUD</em> utilitzant només una classe d'entitat d'un model de domini. Es dirà <code>repository</code>. Poden contenir-ne operacions de dos models.</p>
<h3 id="15-capa-de-model">1.5. Capa de Model</h3>
<p>Contindrà els mapatges de les taules de la base de dades en classes que representen entitats. La capa es dirà <code>model</code>.</p>
<h3 id="16-capa-dto">1.6. Capa DTO</h3>
<p>Els controladors normalment gestionen <code>DTO</code> en lloc de pojos o beans, a causa de l'estructura de l'API o la representació en vistes. Per tant, necessitarem implementar una <em>conversió bidireccional entre un pojo i un model DTO</em>. Més endavant definirem, en els patrons de disseny, què és un DTO i veurem la conversió bidireccional, anomenada mapatge. A més, aquests DTO estaran en una capa separada anomenada <code>dto</code>.</p>
<p><center><img alt="SpringLayers2" src="../img/SpringLayers2.png" width="65%" /></center></p>
<h2 id="2-patrons-de-disseny">2. Patrons de Disseny</h2>
<p>Un patró de disseny és una solució provada que resol un tipus específic de problema de disseny en el desenvolupament de programari. Hi ha molts patrons de disseny que es divideixen en categories, per exemple: creació, estructural, comportamental, interacció, etc.</p>
<p>Per què utilitzar patrons de disseny?: Permeten tenir el codi ben organitzat, llegible i mantenible, també permeten reutilitzar codi i augmenten l'escalabilitat en el teu projecte.</p>
<p>En si mateixos proporcionen una terminologia estàndard i un conjunt de bones pràctiques pel que fa a la solució de problemes de desenvolupament de programari.</p>
<p>Anem a explicar-ne diversos per començar a entendre què són els patrons de disseny.</p>
<h3 id="21-patro-mvc">2.1. Patró MVC.</h3>
<p>Ja hem explicat aquest patró en el tema anterior, però li farem una petita revisió.</p>
<p>Permet separar una aplicació en 3 capes, una manera d'organitzar i fer un projecte escalable. Les capes que podem trobar són:</p>
<ul>
<li><strong>Model</strong>: Aquesta capa representa tot el que té a veure amb l'accés a dades: desar, actualitzar, obtenir dades, així com tot el codi de la lògica de negoci, bàsicament les classes Java i part de la lògica de negoci.</li>
<li><strong>Vista</strong>: La vista té a veure amb la presentació de dades del model i el que l'usuari veu, normalment una vista és la representació visual d'un model (POJO o classe Java). Per exemple, el model d'usuari, que és una classe en Java i les propietats de la qual són nom i cognom, ha de pertànyer a una vista en la qual l'usuari final veu aquestes propietats.</li>
<li><strong>Controlador</strong>: El controlador s'encarrega de connectar el model amb les vistes, funciona com un pont entre la vista i el model, el controlador rep esdeveniments generats per l'usuari des de les vistes i s'encarrega de dirigir la sol·licitud respectiva al model. Per exemple, l'usuari vol veure els clients amb el cognom Álvarez, la sol·licitud va al controlador i aquest s'encarrega d'utilitzar el model adequat i retornar aquest model a la vista.</li>
</ul>
<p>En cap moment la vista interactuarà directament amb el model, això també manté la seguretat en una aplicació.</p>
<p>L'important d'aquest patró és que permet dividir-lo en parts, que són d'alguna manera independents, així que si, per exemple, es fa un canvi en el model, no afectaria la vista o si hi ha un canvi, seria mínim.</p>
<h3 id="22-patro-dto">2.2. Patró DTO.</h3>
<p>Amb aquest patró, es dissenya una de les capes transversals de l'arquitectura. Soluciona el problema de com permetre a un client intercanviar dades amb el servidor sense fer múltiples crides demanant cada peça de dada. Per exemple, si tenim una entitat anomenada Persona i una entitat anomenada Adreces, quan demanem les persones i les seves adreces hem de fer múltiples crides al servidor per demanar les persones i les adreces de cada persona, construint la vista amb aquesta informació.</p>
<p>El DTO ho soluciona passant un objecte lleuger al client amb totes les dades necessàries, juntes. El client pot llavors fer peticions locals a l'objecte que ha rebut.</p>
<p>Per fer això, es creen classes Java que encapsulen les dades en un paquet que es pot transportar per la xarxa (poden implementar <code>java.io.Serializable</code>, tot i que no és obligatori), és a dir, amb l'exemple anterior, crearíem una classe Java que portaria la persona i les seves adreces, tot junt en el mateix objecte.</p>
<p>Aquests objectes s'utilitzen en totes les capes de l'aplicació, de manera que la informació es porta per totes les capes de l'aplicació. Es recomana omplir sempre tots els camps del DTO per evitar errors de <code>NullPointerException</code> (una cadena buida pot ser millor), fer que els DTO siguin autodescriptius, utilitzar arrays o col·leccions de DTO quan sigui necessari, i considerar mètodes que sobreescriguin <code>equals()</code>.</p>
<p>Hi ha dues variants de DTO's:</p>
<ul>
<li>DTOs personalitzats que representen part d'un bean o agrupen múltiples beans.</li>
<li>DTOs de domini anomenats "entitats". Una classe de domini no és directament accessible pel client, ja que, a causa de la separació del patró MVC de la vista, les entitats que mapegen la base de dades (que són les entitats) no poden ser accedides. Per aquesta raó, es fan còpies DTO dels objectes de domini del servidor (entitats). Els clients poden operar sobre còpies locals millorant el rendiment de lectura i actualització.</li>
</ul>
<p>Amb tot això, podem resumir que el DTO és un patró molt efectiu per transmetre informació entre un client i un servidor, ja que ens permet crear estructures de dades independents del nostre model de dades (Entitats), cosa que ens permet crear tantes "vistes" com sigui necessari. A partir d'un conjunt de taules o fonts de dades. A més, ens permet controlar el format, nom i tipus de dades amb què transmetem les dades per ajustar-nos a un determinat requisit. Finalment, si per alguna raó el model de dades canvia (i amb ell les entitats) el client no es veurà afectat, ja que continuarà rebent el mateix DTO.</p>
<p>A continuació veurem com implementar el patró DTO.</p>
<h3 id="23-patro-dao">2.3. Patró DAO</h3>
<p>El patró Data Access Object (DAO), que permet separar la lògica d'accés a dades dels Objectes de Negoci, de tal manera que el DAO encapsula tota la lògica d'accés a dades per a la resta de l'aplicació. Aquesta proposta proposa separar completament la lògica de negoci de la lògica d'accés a dades, d'aquesta manera, el DAO proporcionarà els mètodes necessaris per inserir, actualitzar, eliminar i consultar la informació; d'altra banda, la capa de negoci només es preocupa per la lògica de negoci i utilitza el DAO per interactuar amb la font de dades. En l'exemple que dissenyarem a continuació, veurem com implementar el patró DAO.</p>
<h3 id="24-patro-facade-facana">2.4. Patró FACADE (façana)</h3>
<p>El patró de disseny Facade simplifica la complexitat d'un sistema mitjançant una interfície més senzilla. Millora l'accés al nostre sistema permetent que altres sistemes o subsistemes utilitzin un punt d'accés comú que redueix la complexitat, minimitzant les interaccions i dependències. És a dir, crearem una interfície Java que tindrà els encapçalaments dels mètodes com a punt d'accés comú, mentre que hi haurà classes Java que implementaran aquesta interfície.</p>
<p>Al llarg d'aquest exemple farem ús d'aquest patró.</p>
<h2 id="3-creacio-del-projecte-i-configuracio-de-hibernate">3. Creació del projecte i configuració de Hibernate</h2>
<p>En aquesta secció crearem un programa senzill de Hibernate amb Spring, per aplicar tot el que hem estudiat en unitats anteriors amb Spring. Només hem de crear un nou projecte, seleccionant les dependències que normalment utilitzem:</p>
<p><center><img alt="SpringRest" src="../img/SpringRest.png" width="95%" /></center></p>
<p>Això generarà un <code>pom.xml</code> amb tot el que necessitem.</p>
<p>Necessitem establir els paràmetres que vam establir a <code>hibernate.cfg.xml</code> al fitxer <code>application.properties</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># puerto de escucha</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>server.port<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8090</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1"># Conexión con la BBDD</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>spring.datasource.driver-class-name<span class="o">=</span>com.mysql.cj.jdbc.Driver
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># Datos del SGBD. REVISAR !!!!</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>spring.datasource.url<span class="w"> </span><span class="o">=</span><span class="w"> </span>jdbc:mysql://localhost:3308/AD_UD5_Clientes
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>spring.datasource.username<span class="w"> </span><span class="o">=</span><span class="w"> </span>root
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>spring.datasource.password<span class="w"> </span><span class="o">=</span><span class="w"> </span>root
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="c1"># configuración de hibernate (simple)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>spring.jpa.show-sql<span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>spring.jpa.properties.hibernate.format_sql<span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>spring.jpa.properties.hibernate.dialect<span class="w"> </span><span class="o">=</span><span class="w"> </span>org.hibernate.dialect.MySQL5InnoDBDialect
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="c1"># hbm2DDL. values= none, validate, update, create, and create-drop</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>spring.jpa.hibernate.ddl-auto<span class="o">=</span>validate
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="c1"># import.sql file under src/main/resources/</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="c1"># or data.sql or schema.sql</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="c1"># respetar mayúsculas y minúsculas</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>spring.jpa.hibernate.naming.physical-strategy<span class="o">=</span>org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
</code></pre></div></td></tr></table></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Totes les opcions d'inicialització de la base de dades es poden trobar a <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-initialization">inicialització de la base de dades</a>.</p>
</div>
<h3 id="31-el-model">3.1. El model.</h3>
<p>Anem a utilitzar aquest model per a la nostra pràctica:</p>
<p><center><img alt="DBModel" src="../img/DBModel.png" width="95%" /></center></p>
<div class="admonition warning">
<p class="admonition-title">Advertència</p>
<p>Tens un script per crear la base de dades completa enllaçat <a href="../AD_UD5_Clientes.sql">ací</a>. En aquesta unitat no implementem sobre <code>Movimientos</code>.</p>
</div>
<p>Per crear el model hem de crear els Beans que vam crear a la unitat 3. Podem utilitzar Lombok per millorar el nostre temps de desenvolupament.</p>
<div class="admonition tip">
<p class="admonition-title">Consell</p>
<p>Pots marcar un atribut amb l'anotació de Lombok <code>@ToString.Exclude</code> per evitar que participi en el mètode <code>toString</code>, per exemple, per evitar la recursió.</p>
</div>
<p><code>Cliente</code> DAO en el paquet <code>model</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nd">@Data</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nd">@Entity</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Cliente</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="nd">@Id</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="w"> </span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;nif&quot;</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nif</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;nombre&quot;</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nombre</span><span class="p">;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">apellidos</span><span class="p">;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;claveseguridad&quot;</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">claveSeguridad</span><span class="p">;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">    </span><span class="nd">@OneToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">            </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">            </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cliente&quot;</span><span class="p">)</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">    </span><span class="nd">@ToString.Exclude</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Recomendacion</span><span class="w"> </span><span class="n">recomendacion</span><span class="p">;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">            </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">            </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cliente&quot;</span><span class="p">)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">    </span><span class="nd">@ToString.Exclude</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Cuenta</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listaCuentas</span><span class="p">;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">  </span><span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">,</span><span class="w"> </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">})</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">  </span><span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;clientesdirecciones&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">              </span><span class="n">joinColumns</span><span class="o">=</span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;idcliente&quot;</span><span class="p">),</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">              </span><span class="n">inverseJoinColumns</span><span class="o">=</span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;iddireccion&quot;</span><span class="p">))</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">  </span><span class="nd">@ToString.Exclude</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Direccion</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listaDirecciones</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h3 id="32-el-dto">3.2. El DTO</h3>
<p>Els DTO's (<strong>Data Transfer Object</strong>) serveixen per transferir dades en el nostre sistema a través de transaccions realitzades per les nostres entitats d'una operació a una altra sense perdre la integritat entre les dades.</p>
<p>Per aquesta raó, és important definir que l'accés a les dades es fa només a través de DAO (Data Access Object) del nostre <code>model</code>, obtenint així una abstracció del model de dades. Les dades només s'accedeixen a través de mètodes definits en el <code>DAO</code>. Els DAOs inclouen un altre concepte que és el DTO (Data Transfer Object). Els DTO's són una classe d'objectes que serveixen únicament per transportar dades. El DTO conté les propietats de l'objecte. Dades que poden originar-se a partir d'una o més entitats d'informació.</p>
<p>Una altra bona pràctica és marcar les classes amb el sufix DTO per recordar el seu significat, així la classe <code>Client</code> es convertiria en <code>ClientDTO</code>.</p>
<p>Una de les característiques dels DTO's és que han de ser objectes <code>Serializable</code> per poder viatjar a través de la xarxa. Necessitem indicar aquesta característica en els DTO's, així que afegirem que implementin la interfície Serializable, i amb això, la propietat <code>UID</code> que identifica la versió de cada objecte transportat.</p>
<p>Per crear un DTO crearem una classe amb els atributs que volem que contingui el DTO. Pot ser més o menys que la classe DAO. Després és important crear mètodes per convertir tant de DAO a DTO com de DTO a DAO. Aquests mètodes es poden crear de manera estàtica.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1">// Convierte una entidad DAO a un objeto DTO con todos los datos</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">convertToDTO</span><span class="p">(</span><span class="n">Cliente</span><span class="w"> </span><span class="n">cliente</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="c1">// Creamos el clienteDTO y asignamos los valores basicos</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clienteDTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="p">();</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setIdCliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setNif</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getNif</span><span class="p">());</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setNombre</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getNombre</span><span class="p">());</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="n">clienteDTO</span><span class="p">.</span><span class="na">setApellidos</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">getApellidos</span><span class="p">());</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1">// rest of attributes</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">clienteDTO</span><span class="p">;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="p">}</span><span class="w">       </span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="c1">// Convierte de un objeto a un entidad</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Cliente</span><span class="w"> </span><span class="nf">convertToEntity</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clientedto</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="n">Cliente</span><span class="w">  </span><span class="n">cliente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cliente</span><span class="p">();</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">        </span><span class="n">cliente</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">clientedto</span><span class="p">.</span><span class="na">getIdCliente</span><span class="p">());</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">        </span><span class="n">cliente</span><span class="p">.</span><span class="na">setNif</span><span class="p">(</span><span class="n">clientedto</span><span class="p">.</span><span class="na">getNif</span><span class="p">());</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="c1">// rest of attributes</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cliente</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Com hem dit, evitem accedir a les entitats des de capes superiors.</p>
<div class="admonition tip">
<p class="admonition-title">Ampliació</p>
<p>Pots cercar a internet informació sobre <code>ModelMapper</code> per a gestionar els DTO</p>
</div>
<h4 id="321-convertint-dto-a-json">3.2.1. Convertint DTO a JSON</h4>
<p>Com hem dit, aquests objectes (DTO's) es converteixen a JSON automàticament, però com? Spring utilitza <em>Jackson object mapper</em> per transformar objectes a objectes JSON. En <a href="https://www.baeldung.com/jackson-object-mapper-tutorial">aquest tutorial</a> pots entendre millor com funciona.</p>
<p>Convertir objectes a JSON pot portar-nos a un altre problema de <strong>recursió infinita</strong>, quan l'objecte conté referències creuades, com els mètodes <code>toString()</code>. Hem après com evitar l'excepció <code>StackOverflowException</code> en els mètodes <code>toString()</code>, utilitzant l'anotació <code>@ToString.Exclude</code> de Lombok, però com evitar-ho quan es converteix a JSON. La solució s'ofereix amb noves anotacions, com segueix:</p>
<ul>
<li><code>@JsonIgnore</code> → aquest camp no es convertirà.</li>
<li>
<p><code>@JsonManagedReference</code> → indica que mostrarem la informació d'aquest objecte cap endavant, però no cap enrere. Aquesta anotació es complementarà amb:</p>
</li>
<li>
<p><code>@JsonBackReference</code> → mostra només la informació referenciada, similar a <code>@JsonIgnore</code>.</p>
</li>
<li><code>@JsonIgnoreProperties("property")</code> → omet aquesta propietat en el camp anotat.</li>
</ul>
<p>Si marquem:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">class</span> <span class="nc">Director</span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="c1">// own attributes</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="nd">@JsonManagedReference</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Film</span><span class="o">&gt;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="p">}</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="kd">class</span> <span class="nc">Film</span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">  </span><span class="c1">// own attributes</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">  </span><span class="nd">@JsonBackReference</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">  </span><span class="n">Director</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Mostrarem la informació de la pel·lícula d'un director sense recursió (només els atributs propis).</p>
<p>Podeu trobar més informació <a href="https://www.baeldung.com/jackson-bidirectional-relationships-and-infinite-recursion">aquí</a>.</p>
<h3 id="33-el-repositori">3.3. El repositori</h3>
<p>La capa de repositori és responsable de gestionar l'accés a les dades. Això fa possible separar la lògica de negoci de l'accés a les dades, permetent, per exemple, poder modificar la base de dades del sistema sense afectar la lògica.</p>
<p>En aquesta capa hem de distingir dos tipus d'accés:</p>
<ul>
<li>Accés a dades del model de dades propi del sistema que es farà a través de l'accés DAO (Data Access Object). Per a aquest tipus d'accés, utilitzarem el framework JPA (Java Persistence API) a través de Spring Data.</li>
<li>Accés a sistemes externs a través de connectors (webservices, APIs, etc.)</li>
</ul>
<p>Per aquesta raó, crearem una interfície en la qual tindrem les operacions que exposarem. Aquesta interfície serà <code>ClientRepository.java</code> i es crearà en el paquet <code>repository</code>.</p>
<p>Amb Spring, estalviarem molta feina, ja que simplement definirem una interfície de treball, en la qual indicarem el tipus de repositori que volem crear, la classe sobre la qual treballarà i el tipus de dades que funciona com a identificador d'aquesta classe:</p>
<p>Spring proporciona la <em>Repository Interface</em>, de la qual hereta <code>CrudRepository</code>, que inclou la definició de les operacions bàsiques CRUD. D'aquest últim hereta <code>PagingAndSortingRepository</code>, que afegeix funcions de paginació i ordenació, i finalment tenim <code>JPARepository</code>, que inclou operacions específiques per a JPA.</p>
<p>La importància de la definició genèrica de <code>Repository&lt;Class,Type&gt;</code> és que tots els objectes que recuperarà són d'aquesta classe, i el tipus indica el tipus de la clau primària d'aquesta classe. Seguint el nostre exemple, la definició del repositori seria:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nd">@Repository</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="nd">@Transactional</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ClienteRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Cliente</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Amb això, Spring ja ens permet accedir a la base de dades i realitzar operacions bàsiques. Els següents mètodes estan implementats per defecte, i no necessitarem implementar-los, només definir-los:</p>
<ul>
<li><strong>Recuperar dades</strong>:</li>
<li><code>findAll()</code>, <code>findById(Id)</code>, <code>findById(Iterable&lt;Id&gt;)</code>: recupera una o totes les ocurrències d'un identificador o una col·lecció d'identificadors.</li>
<li><strong>Eliminar dades</strong>:</li>
<li><code>delete(Object)</code>, <code>deleteAll()</code>, <code>deleteById(Id)</code>, <code>deleteAllById(Iterable&lt;Id&gt;)</code>: elimina per objecte, identificador o tots.</li>
<li><strong>comptar i comprovar</strong>:</li>
<li><code>count()</code>, <code>existsById()</code></li>
<li><strong>guardar objectes</strong>:</li>
<li><code>save(Object)</code>, <code>save(Iterable&lt;Object&gt;)</code>: guarda l'objecte(s)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Consell</p>
<p>Si necessitem un altre mètode, l'hem de definir, i després crear una nova classe per implementar aquesta interfície i implementar el mètode.</p>
</div>
<h3 id="34-el-servei">3.4. El servei</h3>
<p>La capa de servei gestiona la lògica de negoci de la nostra aplicació. Aquesta lògica de negoci està separada de la lògica web, que es troba en el controlador.</p>
<p>Quan definim classes que implementen serveis per a la lògica de negoci, s'han de seguir les següents regles:</p>
<ol>
<li>Definir una interfície que tindrà els encapçalaments dels mètodes que es volen publicar. D'aquesta manera fem ús del <strong>patró Facade</strong> i exposem els mètodes del servei per a ser utilitzats.</li>
<li>Definim una classe (tingueu en compte que una interfície pot tenir diverses classes que la implementin) que implementi la interfície, de manera que puguem implementar tots els mètodes del servei seguint la lògica de negoci requerida.</li>
<li>L'anotació <code>@Service</code> indica a Spring que reconegui la classe com un servei (similar a l'anotació <code>@Controller</code> que hem estudiat en la secció anterior).</li>
<li>Utilitzarem <code>@Autowired</code> per injectar el servei en el controlador (ho veurem més endavant).</li>
<li>Utilitzarem <code>@Autowired</code> per injectar el DAO amb el qual treballarem en el servei.</li>
<li>Tingueu en compte que un mètode de servei definirà una operació a nivell de negoci, per exemple, donar un missatge de benvinguda. Els mètodes de servei estaran compostos per altres operacions més petites, que es definiran en la capa de repositori.</li>
</ol>
<p>Amb tot això, començarem a definir la capa de servei. Així que comencem creant una interfície anomenada <code>ClientService.java</code> en el paquet <code>service</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span>
<span class="normal"><a href="#__codelineno-5-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ClienteService</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveCliente</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clienteDTO</span><span class="p">);</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">getClienteById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listAllClientes</span><span class="p">();</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteCliente</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Notem que en aquest cas definim 4 operacions bàsiques amb <code>ClienteDTO</code>, ja que són els objectes que gestionarà el controlador.</p>
<p>Un cop tenim la interfície, creem una nova classe anomenada <code>ClientServiceImpl.java</code>, que s'encarregarà d'implementar els mètodes que es declaren a la interfície. Després, fem que la nova classe implemente la interfície creada i després fem que implementi tots els mètodes de la interfície per defecte. També indiquem l'anotació <code>@Service</code> a la classe. Serà com segueix:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nd">@Service</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClienteServiceImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ClienteService</span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ClienteRepository</span><span class="w"> </span><span class="n">clienteRepository</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveCliente</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">clienteDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">        </span><span class="n">Cliente</span><span class="w"> </span><span class="n">cliente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="p">.</span><span class="na">convertToEntity</span><span class="p">(</span><span class="n">clienteDTO</span><span class="p">);</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">        </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">cliente</span><span class="p">);</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">getClienteById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Cliente</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cliente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="p">.</span><span class="na">convertToDTO</span><span class="p">(</span><span class="n">cliente</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">            </span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listAllClientes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Cliente</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lista</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listaResultado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lista</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">            </span><span class="n">listaResultado</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ClienteDTO</span><span class="p">.</span><span class="na">convertToDTO</span><span class="p">(</span><span class="n">lista</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">listaResultado</span><span class="p">;</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteCliente</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">        </span><span class="n">clienteRepository</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Com podeu veure, el servei s'encarrega d'invocar els mètodes del repositori i de realitzar algunes comprovacions si és necessari. A més, obtenim objectes <code>Cliente</code> i els transformem en <code>ClienteDTO</code> per utilitzar-los per retornar al controlador.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>El mètode <code>findClienteById()</code> retorna una nova classe envoltori (wrapper &lt;&gt;) <code>Optional&lt;Cliente&gt;</code>. Aquesta classe encapsula un Objecte que existirà o no, proporcionant mètodes per comprovar-ho i actuar en conseqüència:</p>
<ul>
<li><code>isPresent()</code> → retorna un booleà.</li>
<li><code>orElse(anotherObject)</code> → si no existeix, retorna un altre Objecte en lloc de l'Optional.</li>
<li><code>get()</code> → retorna l'objecte existent.</li>
</ul>
<p>L'objectiu principal és evitar la famosa <code>NullPointerException</code>. Podeu trobar més informació <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Optional.html">aquí</a></p>
</div>
<h3 id="35-el-controlador">3.5. El controlador</h3>
<p>Ara definirem la capa de més alt nivell, la capa de controladors, on exposarem els serveis de l'aplicació.</p>
<p>El controlador serà l'encarregat de respondre a les sol·licituds dels usuaris amb l'aplicació. Inclourà els serveis, i en cas de crear una aplicació MVC, podrà invocar motors de plantilles, com <em>Thymeleaf</em>. Com hem comentat aquí, ho implementarem en una sola classe (sense seguir el patró anterior).</p>
<p>El controlador invocarà el servei associat a aquesta sol·licitud i retornarà les dades obtingudes o la resposta al mateix client. Hem de marcar la classe amb l'estereotip <code>@Controller</code>. En el cas dels serveis REST, també hem d'indicar que els retorns dels mètodes de la classe es serialitzen a JSON, i ho aconseguim amb <code>@ResponseBody</code>. Des de Spring 4, les dues anotacions s'han fusionat en una, mitjançant <code>@RestController</code>. Només deixarem <code>@Controller</code> per a projectes on retornem una vista (HTML + CSS + JS).</p>
<p>El servei que crearem tindrà un comportament complet pel que fa al manteniment de <code>Cliente</code>, així com la seva recomanació, de manera que podrem llistar clients, veure la seva informació, registrar clients, actualitzar dades de clients i eliminar clients, o ser les operacions CRUD que es coneixen.</p>
<p>Així que començarem creant un controlador anomenat <code>ClienteController.java</code>. Aquest controlador implementarà les 4 operacions corresponents a CRUD: crear, llegir, actualitzar i eliminar. A part d'aquestes 4, crearem una operació que mostrarà la pàgina inicial de l'aplicació, amb un enllaç al manteniment de clients.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nd">@RestController</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ClienteController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ClienteService</span><span class="w"> </span><span class="n">clienteService</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="c1">// mapping the requests. One method per route/request</span>
</code></pre></div></td></tr></table></div>
<p>El controlador normalment defineix quatre operacions CRUD, però podem afegir totes les que necessitem. Vegem-ho.</p>
<h4 id="351-index">3.5.1. Index</h4>
<p>Aquest mètode mapatge l'índex arrel de la nostra aplicació web. Per exemple, podem enviar el nom de l'aplicació i el mòdul. Aquestes variables es poden definir en el nostre <code>application.properties</code> i es poden carregar amb l'anotació <code>@Value</code> i una cadena <code>${property_name}</code> dins.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nd">@Autowired</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${app.name}&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">appName</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${developer.name}&quot;</span><span class="p">)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">devName</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>El controlador d'índex normalment mostra informació general sobre la pàgina principal, com segueix:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="s">&quot;Hello from Spring\n&quot;</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span><span class="n">res</span><span class="o">+=</span><span class="s">&quot;You are running &quot;</span><span class="w"> </span><span class="o">+</span><span class="n">appName</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">  </span><span class="n">res</span><span class="o">+=</span><span class="s">&quot;Developed by &quot;</span><span class="w"> </span><span class="o">+</span><span class="n">devName</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="4-operacions-de-lectura-get">4. Operacions de lectura (<strong>GET</strong>)</h2>
<p>És hora de recuperar dades del nostre servidor, i normalment les operacions <code>GET</code> són els mètodes més demandats. Implementarem diversos mètodes que podrien retornar un o molts objectes de la classe desitjada, en les nostres notes, la classe <code>Cliente</code>.</p>
<h3 id="41-obtenir-tots">4.1. Obtenir tots</h3>
<p>No es necessita cap opció de filtre, perquè volem obtenir tots els clients. Quan rebem aquesta sol·licitud <em>get</em>, hem de cridar al mètode <code>listAll</code> en el nostre servei, que crida, de fet, a <code>findAll</code> en el nostre repositori.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">listClientes</span><span class="p">(){</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRemoteHost</span><span class="p">());</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">losClientes</span><span class="o">=</span><span class="n">clienteService</span><span class="p">.</span><span class="na">listAllClientes</span><span class="p">();</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">losClientes</span><span class="p">;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>A part del missatge de registre, simplement recuperem les dades del servei i les retornem a la resposta.</p>
<h3 id="42-obtenir-un">4.2. Obtenir Un</h3>
<p>Aquesta és la versió més específica, i normalment en la sol·licitud busquem un objecte a partir del seu ID. Llavors, hem d'obtenir un paràmetre en la nostra sol·licitud, i utilitzarem l'ID en el camí, utilitzant l'anotació <code>@PathVariable</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/clientes/{idCliente}&quot;</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="nf">showClienteById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCliente</span><span class="p">){</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRemoteHost</span><span class="p">());</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="n">clienteService</span><span class="p">.</span><span class="na">getClienteById</span><span class="p">(</span><span class="n">idCliente</span><span class="p">);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">elCliente</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>La sol·licitud serà <code>/clientes/7</code>, per exemple, i llavors, en el nostre mètode del controlador, el paràmetre <code>idCliente</code> es configurarà amb el valor 7. Cridem <code>getClienteById(7)</code> i, òbviament, obtenim el <code>ClienteDTO</code> encapsulant el <code>Cliente</code> sol·licitat, si existeix.</p>
<p>Podem millorar els mètodes per al cas que no hi hagi resultats (<code>Cliente</code> no existeix) o s'hagi produït un error, retornant i encapsulant els resultats en un <code>ResponseEntity&lt;Cliente&gt;</code>. Aquesta classe envoltori retorna el resultat a la sol·licitud, però permet afegir un argument que serà el <strong>codi d'estat http</strong>. Aquest codi pot ser capturat a l'aplicació client per al maneig d'errors. L'algoritme serà alguna cosa així:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">results</span><span class="o">&gt;</span><span class="n">controllerMethod</span><span class="p">(){</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="c1">// collect the data from the service/repository</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">mistake</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">Results</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span><span class="w"> </span><span class="c1">// ALL GOOD</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span><span class="w"> </span><span class="c1">// SOMETHING IS WRONG</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>aplicat a la nostra aplicació d'exemple, i fusionant els dos últims exemples de codi, obtindrem el següent:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/clientes/{idCliente}&quot;</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">showClienteById</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCliente</span><span class="p">){</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRemoteHost</span><span class="p">());</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="n">clienteService</span><span class="p">.</span><span class="na">getClienteById</span><span class="p">(</span><span class="n">idCliente</span><span class="p">);</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elCliente</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">  </span><span class="k">else</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">elCliente</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<h3 id="43-gestio-dexcepcions">4.3. Gestió d'excepcions</h3>
<p>El controlador gestiona diverses excepcions, i el programa continua executant-se tret que es produeixi un gran error. Ara presentem un mètode que donarà una resposta quan es produeixi una excepció. Anotarem aquest mètode amb <code>@ExceptionHandler</code>, passant la classe d'excepció que hem de capturar.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">MethodArgumentTypeMismatchException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handleError</span><span class="p">(</span><span class="n">MethodArgumentTypeMismatchException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Method Argument Type Mismatch&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Method Argument Type Mismatch: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">);</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We can handle several exceptions in one unique method, marking it with a collection of exceptions, for instance as:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nd">@ExceptionHandler</span><span class="p">({</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="n">MissingServletRequestParameterException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="n">MethodArgumentTypeMismatchException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="n">InvalidStreamDefinitionException</span><span class="p">.</span><span class="na">class</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="p">})</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handleError</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="c1">// method body</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="c1">// i aquest quan no es troba una entrada al controlador</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">NoHandlerFoundException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">handleNotFoundError</span><span class="p">(</span><span class="n">NoHandlerFoundException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;404 Not Found&quot;</span><span class="p">);</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;El recurso solicitado no existe.&quot;</span><span class="p">);</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getRequestURL</span><span class="p">());</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="5-operacions-de-guardat-post">5. Operacions de guardat (<strong>POST</strong>)</h2>
<p>La primera operació que necessitem fer és guardar un nou <code>Cliente</code> a la nostra base de dades. Anem a explicar-ho amb un exemple. El controlador rebrà un nou objecte DTO enviat per l'aplicació client (utilitzarem Postman, com es pot veure a l'<em>Apèndix 1</em>):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1">//@PostMapping(value=&quot;/clientes&quot;,consumes={&quot;application/json&quot;})</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addDirector</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">newCliente</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">());</span><span class="w"> </span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="w"> </span><span class="n">clienteService</span><span class="p">.</span><span class="na">saveCliente</span><span class="p">(</span><span class="n">newCliente</span><span class="p">);</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elCliente</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">);</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">elCliente</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>tingues en compte que:</p>
<ul>
<li>La sol·licitud està mapejada amb <code>@PostMapping</code>. Aquí tens un comentari amb opcions addicionals.</li>
<li>L'objecte rebut per l'aplicació està dins d'un objecte JSON en el cos de la sol·licitud, marcat com <code>@RequestBody</code>. En aquesta unitat suposarem que les dades arriben ben formatejades.</li>
<li>Les dades rebudes es passen al servei i es retorna un nou <code>Cliente</code> (emmagatzemat).</li>
<li>Aquest client es retorna al client.</li>
</ul>
<p>En aquesta imatge pots veure les dades enviades a l'API i el valor retornat. Tingues en compte que <code>Cuentas</code> i <code>Direcciones</code> no estan presents en aquestes dades. Veurem més endavant com afegir aquestes dades addicionals.</p>
<p><center><img alt="Post_Cliente" src="../img/Post_Cliente.png" width="95%" /></center></p>
<div class="admonition warning">
<p class="admonition-title">Advertència</p>
<p>Hi ha moltes validacions a fer per verificar la integritat de les dades. <a href="https://www.baeldung.com/spring-boot-bean-validation">Aquí</a> pots trobar un article sobre com validar les dades rebudes de les aplicacions client.</p>
</div>
<h2 id="6-operacions-dactualitzacio-put">6. Operacions d'actualització (<strong>PUT</strong>)</h2>
<p>Per actualitzar un objecte de la base de dades, necessitem rebre l'objecte actualitzat (<strong>i complet</strong>) en la sol·licitud. No podem guardar-lo immediatament, perquè podria no existir. Per aquesta raó, hem de comprovar l'existència, i si aquesta és positiva, llavors guardem l'objecte rebut, que actualitzarà la versió anterior a la base de dades. Vegem l'exemple:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nd">@PutMapping</span><span class="p">(</span><span class="s">&quot;/clientes&quot;</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ClienteDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateCliente</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">updCliente</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="n">myLog</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">());</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span><span class="c1">// busquem si existeix prèviament</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elCliente</span><span class="o">=</span><span class="w"> </span><span class="n">clienteService</span><span class="p">.</span><span class="na">getClienteById</span><span class="p">(</span><span class="n">updCliente</span><span class="p">.</span><span class="na">getIdCliente</span><span class="p">());</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elCliente</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="c1">// com ja sabem que existeix, save actualitza</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">    </span><span class="n">ClienteDTO</span><span class="w"> </span><span class="n">elClienteUPD</span><span class="o">=</span><span class="w"> </span><span class="n">clienteService</span><span class="p">.</span><span class="na">saveCliente</span><span class="p">(</span><span class="n">updCliente</span><span class="p">);</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">elClienteUPD</span><span class="p">,</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="7-operacions-deliminacio-delete">7. Operacions d'eliminació (<strong>DELETE</strong>)</h2>
<p>Eliminar és una operació molt senzilla, perquè només necessitem l'identificador de l'objecte que volem eliminar, i després el podem obtenir del camí, dins de la variable de camí. Llavors, hem de cridar l'operació d'eliminació del servei.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nd">@DeleteMapping</span><span class="p">(</span><span class="s">&quot;/clientes/{idCliente}&quot;</span><span class="p">)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">deleteCliente</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCliente</span><span class="p">){</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">  </span><span class="n">clienteService</span><span class="p">.</span><span class="na">deleteCliente</span><span class="p">(</span><span class="n">idCliente</span><span class="p">);</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;Cliente borrado satisfactoriamente&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="8-exercici-completa-el-servidor">8. Exercici. Completa el servidor</h2>
<p>Hem acabat de crear el nostre controlador sobre la classe <code>Cliente</code>, però podem millorar la nostra aplicació afegint més serveis i configuracions al servidor. Aquests conceptes s'estudiaran en les següents seccions.</p>
<p>Recomanem completar el controlador, serveis i repositoris de <code>Cuenta</code> i <code>Direccion</code> amb operacions per defecte.</p>
<p>A més, pots afegir opcions per afegir una <code>Cuenta</code> a un <code>Cliente</code> o eliminar-la, i el mateix amb <code>Direccion</code>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>